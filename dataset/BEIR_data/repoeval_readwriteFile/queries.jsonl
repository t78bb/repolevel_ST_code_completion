{"_id": "读写文件/0", "text": "FUNCTION_BLOCK ReadFile\nVAR_INPUT\n\tbExec\t:\tBOOL;//功能块触发变量\n\tfileName\t:\tSTRING;//文件的路径\nEND_VAR", "metadata": {"task_id": "读写文件/0", "ground_truth": "FUNCTION_BLOCK ReadFile\nVAR_INPUT\n\tbExec\t:\tBOOL;//功能块触发变量\n\tfileName\t:\tSTRING;//文件的路径\nEND_VAR\nVAR\n\tnState\t:\tBYTE;\n\tfileHandle\t:\tUDINT;//文件句柄\n\ti\t:\tBYTE;//定义循环变量\n\t\n\tfbRtrig\t:\tR_TRIG;//实例化上升沿触发功能块\nEND_VAR\nVAR_OUTPUT\n\tReadBuffer\t:\tARRAY[0..255] OF BYTE;//读数缓冲区\n\tnNumRead\t:\tUDINT;//读取文件的字节数\n\tbDone\t:\tBOOL;//写入成功\n\tbBusy\t:\tBOOL;//写入忙\n\tbErr\t:\tBOOL;//写入出错\n\tnErrId\t:\tUDINT;//错误代码\nEND_VAR\n\nCASE nState OF\n\t0:\n\t\tfbRtrig(CLK := bExec);//等待用户触发调用\n\t\tIF fbRtrig.Q THEN\n\t\t\tnState := 1;\n\t\t\tnNumRead := 0;\n\t\t\tbBusy := TRUE;\n\t\t\tbErr := FALSE;\n\t\t\tnErrId := 0;\n\t\t\tbDone := FALSE;\n\t\tEND_IF\n\t1:\n\t\t//打开文件\n\t\tfileHandle := SysFileOpen(szFile := fileName,am := AM_READ,pResult := ADR(nErrId));\n\t\tIF (fileHandle <> 0) AND (nErrId = 0) THEN\n\t\t\tnState := 2;\n\t\tEND_IF\n\t\tIF nErrId <> 0 THEN\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbErr := TRUE; \n\t\tEND_IF\n\t2:\n\t\t//写数据到文件\n\t\tnNumRead := SysFileRead(hFile := fileHandle,pbyBuffer := ADR(ReadBuffer),ulSize := SIZEOF(ReadBuffer),pResult := ADR(nErrId));\n\t\tIF (nNumRead <> 0) AND (nErrId = 0) THEN\n\t\t\tnState := 3;\n\t\tEND_IF\n\t\tIF nErrId <> 0 THEN\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbErr := TRUE; \n\t\tEND_IF\n\t3:\n\t\t//关闭文件\n\t\tnErrId := SysFileClose(hFile := fileHandle);\n\t\tIF nErrId = 0 THEN\n\t\t\tfileHandle := 0;\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbDone := TRUE;\n\t\tEND_IF\n\t\tIF nErrId <> 0 THEN\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbErr := TRUE; \n\t\tEND_IF\nEND_CASE", "fpath_tuple": ["FUN", "ReadFile.st"], "context_start_lineno": 0, "lineno": 6, "function_name": "ReadFile", "line_no": 6}}
{"_id": "读写文件/1", "text": "FUNCTION_BLOCK WriteFile\nVAR_INPUT\n\tbExec\t:\tBOOL;//功能块触发变量\n\twriteBuffer\t:\tARRAY[0..255] OF BYTE;//写数缓冲区\n\twriteNum\t:\tUDINT;//写入数据的字节数\n\tfileName\t:\tSTRING;//文件的路径\nEND_VAR", "metadata": {"task_id": "读写文件/1", "ground_truth": "FUNCTION_BLOCK WriteFile\nVAR_INPUT\n\tbExec\t:\tBOOL;//功能块触发变量\n\twriteBuffer\t:\tARRAY[0..255] OF BYTE;//写数缓冲区\n\twriteNum\t:\tUDINT;//写入数据的字节数\n\tfileName\t:\tSTRING;//文件的路径\nEND_VAR\nVAR\n\tnState\t:\tBYTE;\n\tfileHandle\t:\tUDINT;//文件句柄\n\tnNumWrite\t:\tUDINT;//写入文件的字节数\n\ti\t:\tBYTE;//定义循环变量\n\tfbRtrig\t:\tR_TRIG;//实例化上升沿触发功能块\nEND_VAR\nVAR_OUTPUT\n\tbDone\t:\tBOOL;//写入成功\n\tbBusy\t:\tBOOL;//写入忙\n\tbErr\t:\tBOOL;//写入出错\n\tnErrId\t:\tUDINT;//错误代码\nEND_VAR\n\nCASE nState OF\n\t0:\n\t\tfbRtrig(CLK := bExec);//等待用户触发调用\n\t\tIF fbRtrig.Q THEN\n\t\t\tnState := 1;\n\t\t\tbBusy := TRUE;\n\t\t\tbErr := FALSE;\n\t\t\tnErrId := 0;\n\t\t\tbDone := FALSE;\n\t\tEND_IF\n\t1:\n\t\t//打开文件\n\t\tfileHandle := SysFileOpen(szFile := fileName,am := AM_WRITE,pResult := ADR(nErrId));\n\t\tIF (fileHandle <> 0) AND (nErrId = 0) THEN\n\t\t\tnState := 2;\n\t\tEND_IF\n\t\tIF nErrId <> 0 THEN\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbErr := TRUE; \n\t\tEND_IF\n\t2:\n\t\t//写数据到文件\n\t\tnNumWrite := SysFileWrite(hFile := fileHandle,pbyBuffer := ADR(writeBuffer),ulSize := writeNum,pResult := ADR(nErrId));\n\t\tIF (nNumWrite <> 0) AND (nErrId = 0) THEN\n\t\t\tnState := 3;\n\t\tEND_IF\n\t\tIF nErrId <> 0 THEN\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbErr := TRUE; \n\t\tEND_IF\n\t3:\n\t\t//关闭文件\n\t\tnErrId := SysFileClose(hFile := fileHandle);\n\t\tIF nErrId = 0 THEN\n\t\t\tfileHandle := 0;\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbDone := TRUE;\n\t\tEND_IF\n\t\tIF nErrId <> 0 THEN\n\t\t\tnState := 0;\n\t\t\tbBusy := FALSE;\n\t\t\tbErr := TRUE; \n\t\tEND_IF\nEND_CASE", "fpath_tuple": ["FUN", "WriteFile.st"], "context_start_lineno": 0, "lineno": 8, "function_name": "WriteFile", "line_no": 8}}
