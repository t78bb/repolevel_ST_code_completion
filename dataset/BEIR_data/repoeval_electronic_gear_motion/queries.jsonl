{"_id": "电子齿轮运动实训/0", "text": "FUNCTION_BLOCK FB_DualAxisPower\nVAR_INPUT\n\tAxis1\t\t\t:\tAXIS_REF;\t\t//轴1引用\n\tAxis2\t\t\t:\tAXIS_REF;\t\t//轴2引用\n\tbEnable\t\t\t:\tBOOL := TRUE;\t//使能信号\nEND_VAR\nVAR_OUTPUT\n\tbAxis1Ready\t\t:\tBOOL;\t\t\t//轴1准备就绪\n\tbAxis2Ready\t\t:\tBOOL;\t\t\t//轴2准备就绪\n\tbBothReady\t\t:\tBOOL;\t\t\t//两轴都准备就绪\n\tbError\t\t\t:\tBOOL;\t\t\t//错误标志\nEND_VAR", "metadata": {"task_id": "电子齿轮运动实训/0", "ground_truth": "FUNCTION_BLOCK FB_DualAxisPower\nVAR_INPUT\n\tAxis1\t\t\t:\tAXIS_REF;\t\t//轴1引用\n\tAxis2\t\t\t:\tAXIS_REF;\t\t//轴2引用\n\tbEnable\t\t\t:\tBOOL := TRUE;\t//使能信号\nEND_VAR\nVAR_OUTPUT\n\tbAxis1Ready\t\t:\tBOOL;\t\t\t//轴1准备就绪\n\tbAxis2Ready\t\t:\tBOOL;\t\t\t//轴2准备就绪\n\tbBothReady\t\t:\tBOOL;\t\t\t//两轴都准备就绪\n\tbError\t\t\t:\tBOOL;\t\t\t//错误标志\nEND_VAR\nVAR\n\tfbPower1\t\t:\tMC_Power;\t\t//轴1电源控制\n\tfbPower2\t\t:\tMC_Power;\t\t//轴2电源控制\nEND_VAR\n\n// 执行轴1电源控制\nfbPower1(\n\tAxis := Axis1,\n\tEnable := bEnable,\n\tbDriveStart := TRUE,\n\tbRegulatorOn := TRUE\n);\n\n// 执行轴2电源控制\nfbPower2(\n\tAxis := Axis2,\n\tEnable := bEnable,\n\tbDriveStart := TRUE,\n\tbRegulatorOn := TRUE\n);\n\n// 更新输出状态\nbAxis1Ready := fbPower1.Status;\nbAxis2Ready := fbPower2.Status;\nbBothReady := fbPower1.Status AND fbPower2.Status;\nbError := fbPower1.Error OR fbPower2.Error;", "fpath_tuple": ["FUN", "FB_DualAxisPower.st"], "context_start_lineno": 0, "lineno": 13, "function_name": "FB_DualAxisPower", "line_no": 13}}
{"_id": "电子齿轮运动实训/1", "text": "FUNCTION_BLOCK FB_GearCoupling\nVAR_INPUT\n\tMaster\t\t\t\t:\tAXIS_REF;\t\t//主轴引用\n\tSlave\t\t\t\t:\tAXIS_REF;\t\t//从轴引用\n\tbCouple\t\t\t\t:\tBOOL;\t\t\t//TRUE=耦合，FALSE=解耦\n\tnRatioNumerator\t\t:\tINT := 1;\t\t//传动比分子\n\tnRatioDenominator\t:\tINT := 1;\t\t//传动比分母\n\trAcceleration\t\t:\tREAL := 10000.0;//加速度\n\trDeceleration\t\t:\tREAL := 10000.0;//减速度\nEND_VAR\nVAR_OUTPUT\n\tbInGear\t\t\t\t:\tBOOL;\t\t\t//耦合状态\n\tbCouplingDone\t\t:\tBOOL;\t\t\t//耦合完成\n\tbDecouplingDone\t\t:\tBOOL;\t\t\t//解耦完成\n\tbError\t\t\t\t:\tBOOL;\t\t\t//错误标志\n\tnErrorID\t\t\t:\tDWORD;\t\t\t//错误代码\nEND_VAR", "metadata": {"task_id": "电子齿轮运动实训/1", "ground_truth": "FUNCTION_BLOCK FB_GearCoupling\nVAR_INPUT\n\tMaster\t\t\t\t:\tAXIS_REF;\t\t//主轴引用\n\tSlave\t\t\t\t:\tAXIS_REF;\t\t//从轴引用\n\tbCouple\t\t\t\t:\tBOOL;\t\t\t//TRUE=耦合，FALSE=解耦\n\tnRatioNumerator\t\t:\tINT := 1;\t\t//传动比分子\n\tnRatioDenominator\t:\tINT := 1;\t\t//传动比分母\n\trAcceleration\t\t:\tREAL := 10000.0;//加速度\n\trDeceleration\t\t:\tREAL := 10000.0;//减速度\nEND_VAR\nVAR_OUTPUT\n\tbInGear\t\t\t\t:\tBOOL;\t\t\t//耦合状态\n\tbCouplingDone\t\t:\tBOOL;\t\t\t//耦合完成\n\tbDecouplingDone\t\t:\tBOOL;\t\t\t//解耦完成\n\tbError\t\t\t\t:\tBOOL;\t\t\t//错误标志\n\tnErrorID\t\t\t:\tDWORD;\t\t\t//错误代码\nEND_VAR\nVAR\n\tfbGearIn\t\t\t:\tMC_GearIn;\t\t//齿轮耦合功能块\n\tfbGearOut\t\t\t:\tMC_GearOut;\t\t//齿轮解耦功能块\n\tbLastCouple\t\t\t:\tBOOL;\t\t\t//上次耦合状态\n\tbCoupleRising\t\t:\tBOOL;\t\t\t//耦合上升沿\n\tbCoupleFalling\t\t:\tBOOL;\t\t\t//耦合下降沿\nEND_VAR\n\n// 检测耦合信号的边沿\nbCoupleRising := bCouple AND NOT bLastCouple;\nbCoupleFalling := NOT bCouple AND bLastCouple;\nbLastCouple := bCouple;\n\n// 齿轮耦合控制\nIF bCouple THEN\n\t// 执行耦合\n\tfbGearIn(\n\t\tExecute := TRUE,\n\t\tMaster := Master,\n\t\tSlave := Slave,\n\t\tRatioNumerator := nRatioNumerator,\n\t\tRatioDenominator := nRatioDenominator,\n\t\tAcceleration := rAcceleration,\n\t\tDeceleration := rDeceleration\n\t);\n\t\n\tbInGear := fbGearIn.InGear;\n\tbCouplingDone := fbGearIn.InGear;\n\tbDecouplingDone := FALSE;\n\tbError := fbGearIn.Error;\n\tnErrorID := fbGearIn.ErrorID;\nELSE\n\t// 执行解耦\n\tfbGearIn(Execute := FALSE, Master := Master, Slave := Slave);\n\t\n\tfbGearOut(\n\t\tExecute := TRUE,\n\t\tSlave := Slave\n\t);\n\t\n\tbInGear := FALSE;\n\tbCouplingDone := FALSE;\n\tbDecouplingDone := fbGearOut.Done;\n\tbError := fbGearOut.Error;\n\tnErrorID := fbGearOut.ErrorID;\n\t\n\t// 解耦完成后复位\n\tIF fbGearOut.Done THEN\n\t\tfbGearOut(Execute := FALSE, Slave := Slave);\n\tEND_IF\nEND_IF", "fpath_tuple": ["FUN", "FB_GearCoupling.st"], "context_start_lineno": 0, "lineno": 18, "function_name": "FB_GearCoupling", "line_no": 18}}
{"_id": "电子齿轮运动实训/2", "text": "FUNCTION_BLOCK FB_GearMotionControl\nVAR_INPUT\n\tMasterAxis\t\t\t:\tAXIS_REF;\t\t//主轴引用\n\tSlaveAxis\t\t\t:\tAXIS_REF;\t\t//从轴引用\n\tbStart\t\t\t\t:\tBOOL;\t\t\t//启动信号\n\tbStop\t\t\t\t:\tBOOL;\t\t\t//停止信号\n\tnRatioNumerator\t\t:\tINT := 1;\t\t//传动比分子\n\tnRatioDenominator\t:\tINT := 1;\t\t//传动比分母\n\tnDirection\t\t\t:\tINT := 1;\t\t//运动方向（1=正向，-1=反向）\n\trVelocity\t\t\t:\tREAL := 360.0;\t//主轴速度\n\trAcceleration\t\t:\tREAL := 10000.0;//加速度\n\trDeceleration\t\t:\tREAL := 10000.0;//减速度\nEND_VAR\nVAR_OUTPUT\n\tbRunning\t\t\t:\tBOOL;\t\t\t//运行中\n\tbReady\t\t\t\t:\tBOOL;\t\t\t//准备就绪（可以启动）\n\tbError\t\t\t\t:\tBOOL;\t\t\t//错误标志\n\tnCurrentState\t\t:\tBYTE;\t\t\t//当前状态\nEND_VAR", "metadata": {"task_id": "电子齿轮运动实训/2", "ground_truth": "FUNCTION_BLOCK FB_GearMotionControl\nVAR_INPUT\n\tMasterAxis\t\t\t:\tAXIS_REF;\t\t//主轴引用\n\tSlaveAxis\t\t\t:\tAXIS_REF;\t\t//从轴引用\n\tbStart\t\t\t\t:\tBOOL;\t\t\t//启动信号\n\tbStop\t\t\t\t:\tBOOL;\t\t\t//停止信号\n\tnRatioNumerator\t\t:\tINT := 1;\t\t//传动比分子\n\tnRatioDenominator\t:\tINT := 1;\t\t//传动比分母\n\tnDirection\t\t\t:\tINT := 1;\t\t//运动方向（1=正向，-1=反向）\n\trVelocity\t\t\t:\tREAL := 360.0;\t//主轴速度\n\trAcceleration\t\t:\tREAL := 10000.0;//加速度\n\trDeceleration\t\t:\tREAL := 10000.0;//减速度\nEND_VAR\nVAR_OUTPUT\n\tbRunning\t\t\t:\tBOOL;\t\t\t//运行中\n\tbReady\t\t\t\t:\tBOOL;\t\t\t//准备就绪（可以启动）\n\tbError\t\t\t\t:\tBOOL;\t\t\t//错误标志\n\tnCurrentState\t\t:\tBYTE;\t\t\t//当前状态\nEND_VAR\nVAR\n\tfbPowerMgr\t\t\t:\tFB_DualAxisPower;\t//双轴电源管理\n\tfbGearCtrl\t\t\t:\tFB_GearCoupling;\t//齿轮耦合控制\n\tfbMoveVel\t\t\t:\tMC_MoveVelocity;\t//速度运动\n\tfbHaltMaster\t\t:\tMC_Halt;\t\t\t//主轴停止\n\tfbHaltSlave\t\t\t:\tMC_Halt;\t\t\t//从轴停止\n\tfbStartRtrig\t\t:\tR_TRIG;\t\t\t\t//启动上升沿\n\tfbStopRtrig\t\t\t:\tR_TRIG;\t\t\t\t//停止上升沿\n\tnState\t\t\t\t:\tBYTE;\t\t\t\t//内部状态机\nEND_VAR\n\n// 双轴电源管理\nfbPowerMgr(\n\tAxis1 := MasterAxis,\n\tAxis2 := SlaveAxis,\n\tbEnable := TRUE\n);\n\n// 状态机\nCASE nState OF\n\t0: (* 等待轴准备就绪 *)\n\t\tbRunning := FALSE;\n\t\tbReady := FALSE;\n\t\tIF fbPowerMgr.bBothReady THEN\n\t\t\tnState := 1;\n\t\t\tbReady := TRUE;\n\t\tEND_IF\n\t\t\n\t1: (* 等待启动信号 *)\n\t\tbRunning := FALSE;\n\t\tbReady := TRUE;\n\t\tfbStartRtrig(CLK := bStart);\n\t\tIF fbStartRtrig.Q THEN\n\t\t\tnState := 2;\n\t\t\t// 初始化复位\n\t\t\tfbGearCtrl.bCouple := FALSE;\n\t\t\tfbMoveVel(Execute := FALSE, Axis := MasterAxis);\n\t\tEND_IF\n\t\t\n\t2: (* 执行齿轮耦合和运动 *)\n\t\tbRunning := TRUE;\n\t\tbReady := FALSE;\n\t\t\n\t\t// 启动齿轮耦合\n\t\tfbGearCtrl(\n\t\t\tMaster := MasterAxis,\n\t\t\tSlave := SlaveAxis,\n\t\t\tbCouple := TRUE,\n\t\t\tnRatioNumerator := nRatioNumerator,\n\t\t\tnRatioDenominator := nRatioDenominator,\n\t\t\trAcceleration := rAcceleration,\n\t\t\trDeceleration := rDeceleration\n\t\t);\n\t\t\n\t\t// 主轴执行速度运动\n\t\tfbMoveVel(\n\t\t\tExecute := fbGearCtrl.bInGear,\n\t\t\tDirection := nDirection,\n\t\t\tVelocity := rVelocity,\n\t\t\tAcceleration := rAcceleration,\n\t\t\tDeceleration := rDeceleration,\n\t\t\tAxis := MasterAxis\n\t\t);\n\t\t\n\t\t// 检测停止信号\n\t\tfbStopRtrig(CLK := bStop);\n\t\tIF fbStopRtrig.Q THEN\n\t\t\tnState := 3;\n\t\t\tfbMoveVel(Execute := FALSE, Axis := MasterAxis);\n\t\t\tfbHaltMaster(Axis := MasterAxis, Execute := FALSE);\n\t\tEND_IF\n\t\t\n\t3: (* 停止主轴 *)\n\t\tbRunning := FALSE;\n\t\t\n\t\t// 解除齿轮耦合\n\t\tfbGearCtrl(\n\t\t\tMaster := MasterAxis,\n\t\t\tSlave := SlaveAxis,\n\t\t\tbCouple := FALSE\n\t\t);\n\t\t\n\t\t// 停止主轴\n\t\tfbHaltMaster(\n\t\t\tAxis := MasterAxis,\n\t\t\tExecute := TRUE,\n\t\t\tDeceleration := rDeceleration\n\t\t);\n\t\t\n\t\tIF fbHaltMaster.Done THEN\n\t\t\tfbHaltMaster(Axis := MasterAxis, Execute := FALSE);\n\t\t\tfbHaltSlave(Axis := SlaveAxis, Execute := FALSE);\n\t\t\tnState := 4;\n\t\tEND_IF\n\t\t\n\t4: (* 停止从轴 *)\n\t\t// 等待解耦完成\n\t\tIF fbGearCtrl.bDecouplingDone THEN\n\t\t\tfbHaltSlave(\n\t\t\t\tAxis := SlaveAxis,\n\t\t\t\tExecute := TRUE,\n\t\t\t\tDeceleration := rDeceleration\n\t\t\t);\n\t\t\t\n\t\t\tIF fbHaltSlave.Done THEN\n\t\t\t\tfbHaltSlave(Axis := SlaveAxis, Execute := FALSE);\n\t\t\t\tnState := 1;  // 返回等待启动状态\n\t\t\tEND_IF\n\t\tEND_IF\nEND_CASE\n\n// 更新输出\nnCurrentState := nState;\nbError := fbPowerMgr.bError OR fbGearCtrl.bError OR fbMoveVel.Error OR fbHaltMaster.Error OR fbHaltSlave.Error;", "fpath_tuple": ["FUN", "FB_GearMotionControl.st"], "context_start_lineno": 0, "lineno": 20, "function_name": "FB_GearMotionControl", "line_no": 20}}
