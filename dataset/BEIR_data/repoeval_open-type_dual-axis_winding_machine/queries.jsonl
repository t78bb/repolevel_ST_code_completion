{"_id": "开放式双轴卷绕机编程开发实训/0", "text": "FUNCTION_BLOCK CheckF\nVAR_INPUT\n\tlM\t:\tLREAL;\n\tlL\t:\tLREAL;\n\tlH\t:\tLREAL;\nEND_VAR\nVAR_OUTPUT\n\tlF\t:\tLREAL;\nEND_VAR", "metadata": {"task_id": "开放式双轴卷绕机编程开发实训/0", "ground_truth": "FUNCTION_BLOCK CheckF\nVAR_INPUT\n\tlM\t:\tLREAL;\n\tlL\t:\tLREAL;\n\tlH\t:\tLREAL;\nEND_VAR\nVAR_OUTPUT\n\tlF\t:\tLREAL;\nEND_VAR\nVAR\nEND_VAR\n\nIF lH<>0 THEN\n\tlF:=9.8*lM/(2*COS(ATAN(lL/lH)));\nEND_IF", "fpath_tuple": ["FUN", "CheckF.st"], "context_start_lineno": 0, "lineno": 10, "function_name": "CheckF", "line_no": 10}}
{"_id": "开放式双轴卷绕机编程开发实训/1", "text": "FUNCTION F_CalculateRadius : LREAL\nVAR_INPUT\n\tlD\t\t\t\t:\tLREAL;\t\t//两轴中心距离\n\tlHold\t\t\t:\tLREAL;\t\t//测量开始时的AxisV位置\n\tlHnew\t\t\t:\tLREAL;\t\t//测量结束时的AxisV位置\n\tlTk\t\t\t\t:\tLREAL;\t\t//材料厚度\n\tlOffset\t\t\t:\tLREAL;\t\t//高度偏移量\nEND_VAR", "metadata": {"task_id": "开放式双轴卷绕机编程开发实训/1", "ground_truth": "FUNCTION F_CalculateRadius : LREAL\nVAR_INPUT\n\tlD\t\t\t\t:\tLREAL;\t\t//两轴中心距离\n\tlHold\t\t\t:\tLREAL;\t\t//测量开始时的AxisV位置\n\tlHnew\t\t\t:\tLREAL;\t\t//测量结束时的AxisV位置\n\tlTk\t\t\t\t:\tLREAL;\t\t//材料厚度\n\tlOffset\t\t\t:\tLREAL;\t\t//高度偏移量\nEND_VAR\n\n// 半径计算公式：\n// R = |√(D²+(Hnew+offset)²) - √(D²+(Hold+offset)²)| / π + Tk\nF_CalculateRadius := ABS(SQRT(EXPT(lD,2)+EXPT(lHnew+lOffset,2)) - SQRT(EXPT(lD,2)+EXPT(lHold+lOffset,2))) / SMC_PI + lTk;", "fpath_tuple": ["FUN", "F_CalculateRadius.st"], "context_start_lineno": 0, "lineno": 9, "function_name": "F_CalculateRadius", "line_no": 9}}
{"_id": "开放式双轴卷绕机编程开发实训/2", "text": "FUNCTION F_CompensateVelocity : LREAL\nVAR_INPUT\n\tlCurrentVel\t\t:\tLREAL;\t\t//当前速度\n\tlOldPos\t\t\t:\tLREAL;\t\t//上一次位置\n\tlNewPos\t\t\t:\tLREAL;\t\t//当前位置\n\tlRadius\t\t\t:\tLREAL;\t\t//当前半径\n\tlTk\t\t\t\t:\tLREAL;\t\t//材料厚度\n\tbUnwinding\t\t:\tBOOL;\t\t//TRUE=放卷（半径减小），FALSE=收卷（半径增加）\nEND_VAR", "metadata": {"task_id": "开放式双轴卷绕机编程开发实训/2", "ground_truth": "FUNCTION F_CompensateVelocity : LREAL\nVAR_INPUT\n\tlCurrentVel\t\t:\tLREAL;\t\t//当前速度\n\tlOldPos\t\t\t:\tLREAL;\t\t//上一次位置\n\tlNewPos\t\t\t:\tLREAL;\t\t//当前位置\n\tlRadius\t\t\t:\tLREAL;\t\t//当前半径\n\tlTk\t\t\t\t:\tLREAL;\t\t//材料厚度\n\tbUnwinding\t\t:\tBOOL;\t\t//TRUE=放卷（半径减小），FALSE=收卷（半径增加）\nEND_VAR\n\n// 检查轴是否在运动（位置是否变化）\nIF lOldPos > lNewPos THEN\n\tIF bUnwinding THEN\n\t\t// 放卷：半径减小，速度需要增加\n\t\t// 公式：V_new = V_old + V_old * Tk / (R - Tk)\n\t\tIF (lRadius - lTk) > 0.01 THEN  // 避免除零\n\t\t\tF_CompensateVelocity := lCurrentVel + lCurrentVel * lTk / (lRadius - lTk);\n\t\tELSE\n\t\t\tF_CompensateVelocity := lCurrentVel;\n\t\tEND_IF\n\tELSE\n\t\t// 收卷：半径增加，速度需要降低\n\t\t// 公式：V_new = V_old - V_old * Tk / (R + Tk)\n\t\tF_CompensateVelocity := lCurrentVel - lCurrentVel * lTk / (lRadius + lTk);\n\tEND_IF\nELSE\n\t// 位置未变化，保持当前速度\n\tF_CompensateVelocity := lCurrentVel;\nEND_IF", "fpath_tuple": ["FUN", "F_CompensateVelocity.st"], "context_start_lineno": 0, "lineno": 10, "function_name": "F_CompensateVelocity", "line_no": 10}}
{"_id": "开放式双轴卷绕机编程开发实训/3", "text": "FUNCTION_BLOCK SeekHome\nVAR_IN_OUT \n\t_Axis\t:\tAXIS_REF_SM3;\nEND_VAR\nVAR_INPUT\n\t_xHome\t:\tBOOL;\n\t_xAbort\t:\tBOOL;\n\t_nHomeMode\t:\tHomeMode;\n\t_fFastHomeVel\t:\tLREAL;\n\t_fSlowHomeVel\t:\tLREAL;\n\t_fHomeAcc\t\t:\tLREAL;\n\t_fHomeDec\t\t:\tLREAL;\n\t_fHomePos\t\t:\tLREAL;\n\t_xReferenceSwitch\t:\tBOOL;//typically is true\n\t_nDirection\t:\tMC_DIRECTION;\n\t_xIndexPulse\t:\tBOOL;\nEND_VAR\nVAR_OUTPUT\n\t_xBusy\t:\tBOOL;\n\t_xDone\t:\tBOOL;\n\t_xErr\t:\tBOOL;\n\t_iErrId\t:\tDINT;\nEND_VAR", "metadata": {"task_id": "开放式双轴卷绕机编程开发实训/3", "ground_truth": "FUNCTION_BLOCK SeekHome\nVAR_IN_OUT \n\t_Axis\t:\tAXIS_REF_SM3;\nEND_VAR\nVAR_INPUT\n\t_xHome\t:\tBOOL;\n\t_xAbort\t:\tBOOL;\n\t_nHomeMode\t:\tHomeMode;\n\t_fFastHomeVel\t:\tLREAL;\n\t_fSlowHomeVel\t:\tLREAL;\n\t_fHomeAcc\t\t:\tLREAL;\n\t_fHomeDec\t\t:\tLREAL;\n\t_fHomePos\t\t:\tLREAL;\n\t_xReferenceSwitch\t:\tBOOL;//typically is true\n\t_nDirection\t:\tMC_DIRECTION;\n\t_xIndexPulse\t:\tBOOL;\nEND_VAR\nVAR_OUTPUT\n\t_xBusy\t:\tBOOL;\n\t_xDone\t:\tBOOL;\n\t_xErr\t:\tBOOL;\n\t_iErrId\t:\tDINT;\nEND_VAR\nVAR\n\t_fbMoveVel\t:\tMC_MoveVelocity;\n\t_fbMoveAbs\t:\tMC_MoveAbsolute;\n\t_fbHalt\t\t:\tMC_Halt;\n\t_fbSetPos\t:\tMC_SetPosition;\n\t_fbRtrig\t\t:\tR_TRIG;\n\t_fbFtrig\t\t:\tF_TRIG;\n\t_nBDirection\t:\tMC_DIRECTION;\n\t_fTempPos\t\t:\tLREAL;\n\t_nState\t\t:\tUSINT;\n\tfbRtrig\t:\tR_TRIG;\nEND_VAR\n\n//check left / arrive the ReferenceSwitch\n_fbRtrig(CLK := _xReferenceSwitch);\n_fbFtrig(CLK := _xReferenceSwitch);\nfbRtrig(CLK := _xHome);\n\nIF NOT _xHome THEN\n\t_fbMoveVel(Axis := _Axis,Execute := FALSE);\n\t_fbMoveAbs(Axis := _Axis,Execute := FALSE);\n\t_fbHalt(Axis := _Axis,Execute := FALSE);\n\t_fbSetPos(Axis := _Axis,Execute := FALSE);\n\t_xDone := FALSE;\n\t_xErr := FALSE;\nEND_IF\n\nCASE _nState OF\n\t0:\n\t\tIF fbRtrig.Q THEN\n\t\t\t_xBusy := TRUE;\n\t\t\t_xDone := FALSE;\n\t\t\t_xErr := FALSE;\n\t\t\t_iErrId := 0;\n\t\t\n\t\t\tCASE _nDirection OF //cal which is the invert direction\n\t\t\t\tMC_DIRECTION.positive:\n\t\t\t\t\t_nBDirection := MC_DIRECTION.negative;\n\t\t\t\tMC_DIRECTION.negative:\n\t\t\t\t\t_nBDirection := MC_DIRECTION.positive;\n\t\t\t\tELSE\n\t\t\t\t\t_xErr := TRUE;\n\t\t\tEND_CASE\n\t\t\t\n\t\t\tCASE _nHomeMode OF\n\t\t\t\tHomeMode.FAST_ZERO:\n\t\t\t\t\t_fTempPos := 0;\n\t\t\t\t\t_nState := 21;\n\t\t\t\tHomeMode.FAST_BSLOW_STOP_S:\n\t\t\t\t\t_nState := 1;\n\t\t\t\tHomeMode.FAST_SLOW_STOP_S:\n\t\t\t\t\t_nState := 11;\n\t\t\t\tHomeMode.FAST_BSLOW_I_STOP_S:\n\t\t\t\t\t_nState := 31;\n\t\t\t\tHomeMode.FAST_SLOW_I_STOP_S:\n\t\t\t\t\t_nState := 41;\n\t\t\tEND_CASE\n\t\tEND_IF\n\t50:\n\t\t_fbMoveAbs(Execute := TRUE,Axis := _Axis,Position := _fTempPos,Velocity := _fSlowHomeVel,Acceleration := _fHomeAcc,Deceleration := _fHomeDec);\n\t\tIF _fbMoveAbs.Done THEN\n\t\t\t_fbMoveAbs(Execute := FALSE,Axis := _Axis);\n\t\t\t_nState := 100;\n\t\tEND_IF\n\t\tIF _fbMoveAbs.Error THEN//meet error\n\t\t\t_nState := 200;\n\t\t\t_iErrId := _fbMoveAbs.ErrorID;\n\t\tEND_IF\n\t100:\n\t\t_fbSetPos(Execute := TRUE,Axis := _Axis,Position := _fHomePos,Mode := FALSE);//set absolute position\n\t\tIF _fbSetPos.Done THEN\n\t\t\t_fbSetPos(Execute := FALSE,Axis := _Axis);\n\t\t\t_xDone := TRUE;\n\t\t\t_xBusy := FALSE;\n\t\t\t_nState := 0;\n\t\tEND_IF\n\t\tIF _fbSetPos.Error THEN//meet error\n\t\t\t_iErrId := _fbSetPos.ErrorID;\n\t\t\t_nState := 200;\n\t\tEND_IF\n\t200:\n\t\t_xErr := TRUE;\n\t\t_xBusy := FALSE;\n\t\t_nState := 0;\nEND_CASE\n\nFAST_ZERO();\nFAST_BSLOW_STOP_S();\nFAST_SLOW_STOP_S();\nFAST_BSLOW_I_STOP_S();\nFAST_SLOW_I_STOP_S();", "fpath_tuple": ["FUN", "SeekHome.st"], "context_start_lineno": 0, "lineno": 24, "function_name": "SeekHome", "line_no": 24}}
{"_id": "开放式双轴卷绕机编程开发实训/4", "text": "FUNCTION_BLOCK StaDisplay\nVAR_INPUT\n\tiStatus :\tINT;\nEND_VAR\nVAR_OUTPUT\n\tY1,Y2,Y3,Y4,Y5,Y6\t:\tBOOL;\nEND_VAR", "metadata": {"task_id": "开放式双轴卷绕机编程开发实训/4", "ground_truth": "FUNCTION_BLOCK StaDisplay\nVAR_INPUT\n\tiStatus :\tINT;\nEND_VAR\nVAR_OUTPUT\n\tY1,Y2,Y3,Y4,Y5,Y6\t:\tBOOL;\nEND_VAR\nVAR\nEND_VAR\n\nCASE iStatus OF\n\t2,3,4,5,6,7,8,9,10,221,222:\n\tY5:=FALSE;\n\tY6:=TRUE;\n\tY1:=TRUE;\n\tY2:=FALSE;\n\tY3:=FALSE;\n\tY4:=FALSE;\n\t11,12:\n\tY5:=FALSE;\n\tY6:=TRUE;\n\tY1:=FALSE;\n\tY2:=TRUE;\n\tY3:=FALSE;\n\tY4:=FALSE;\n\t13,14,15,16,17,18,19,20,21,22:\n\tY5:=TRUE;\n\tY6:=FALSE;\n\tY1:=FALSE;\n\tY2:=FALSE;\n\tY3:=TRUE;\n\tY4:=FALSE;\n\t23,24:\n\tY5:=TRUE;\n\tY6:=FALSE;\n\tY1:=FALSE;\n\tY2:=FALSE;\n\tY3:=FALSE;\n\tY4:=TRUE;\n\tELSE \n\tY5:=TRUE;\n\tY6:=TRUE;\n\tY1:=FALSE;\n\tY2:=FALSE;\n\tY3:=FALSE;\n\tY4:=FALSE;\nEND_CASE", "fpath_tuple": ["FUN", "StaDisplay.st"], "context_start_lineno": 0, "lineno": 8, "function_name": "StaDisplay", "line_no": 8}}
