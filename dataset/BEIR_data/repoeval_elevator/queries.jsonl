{"_id": "elevator/0", "text": "FUNCTION_BLOCK FB_ElevatorDoorController\nVAR_INPUT\n\tbArrivedAtTarget\t:\tBOOL;\t\t// 到达目标楼层\n\tbDoorClosed\t\t\t:\tBOOL;\t\t// 门已关闭传感器\nEND_VAR\nVAR_OUTPUT\n\tbOpenDoor\t\t\t:\tBOOL;\t\t// 开门命令\n\tbCloseDoor\t\t\t:\tBOOL;\t\t// 关门命令\n\tbDoorOpen\t\t\t:\tBOOL;\t\t// 门打开状态\n\tbDoorReady\t\t\t:\tBOOL;\t\t// 门准备好（可以移动）\nEND_VAR", "metadata": {"task_id": "elevator/0", "ground_truth": "FUNCTION_BLOCK FB_ElevatorDoorController\nVAR_INPUT\n\tbArrivedAtTarget\t:\tBOOL;\t\t// 到达目标楼层\n\tbDoorClosed\t\t\t:\tBOOL;\t\t// 门已关闭传感器\nEND_VAR\nVAR_OUTPUT\n\tbOpenDoor\t\t\t:\tBOOL;\t\t// 开门命令\n\tbCloseDoor\t\t\t:\tBOOL;\t\t// 关门命令\n\tbDoorOpen\t\t\t:\tBOOL;\t\t// 门打开状态\n\tbDoorReady\t\t\t:\tBOOL;\t\t// 门准备好（可以移动）\nEND_VAR\nVAR\n\tfbDoorTimer\t\t\t:\tTON;\t\t// 开门延时定时器\n\tfbCloseDoorTimer\t:\tTON;\t\t// 关门延时定时器\n\tnState\t\t\t\t:\tINT;\t\t// 状态机\nEND_VAR\n\nCASE nState OF\n\t0: // 空闲状态\n\t\tbOpenDoor := FALSE;\n\t\tbCloseDoor := FALSE;\n\t\tbDoorReady := TRUE;\n\t\t\n\t\tIF bArrivedAtTarget THEN\n\t\t\tnState := 1; // 开始开门流程\n\t\tEND_IF\n\t\t\n\t1: // 开门延时\n\t\tbCloseDoor := FALSE;\n\t\tbDoorReady := FALSE;\n\t\tfbDoorTimer(IN := TRUE, PT := T#2S);\n\t\t\n\t\tIF fbDoorTimer.Q THEN\n\t\t\tfbDoorTimer(IN := FALSE);\n\t\t\tnState := 2;\n\t\tEND_IF\n\t\t\n\t2: // 开门\n\t\tbOpenDoor := TRUE;\n\t\tbDoorOpen := TRUE;\n\t\tnState := 3;\n\t\t\n\t3: // 等待开始关门\n\t\tIF NOT bArrivedAtTarget THEN\n\t\t\tnState := 4; // 开始关门流程\n\t\tEND_IF\n\t\t\n\t4: // 关门\n\t\tbOpenDoor := FALSE;\n\t\tbCloseDoor := TRUE;\n\t\tbDoorOpen := FALSE;\n\t\tfbCloseDoorTimer(IN := TRUE, PT := T#2S);\n\t\t\n\t\tIF fbCloseDoorTimer.Q AND bDoorClosed THEN\n\t\t\tfbCloseDoorTimer(IN := FALSE);\n\t\t\tnState := 0; // 返回空闲\n\t\tEND_IF\nEND_CASE", "fpath_tuple": ["FUN", "FB_ElevatorDoorController.st"], "context_start_lineno": 0, "lineno": 12, "function_name": "FB_ElevatorDoorController", "line_no": 12}}
{"_id": "elevator/1", "text": "FUNCTION_BLOCK FB_ElevatorMovement\nVAR_INPUT\n\tCurrentFloor\t\t:\tINT;\t\t\t\t// 当前楼层\n\tbDoorReady\t\t\t:\tBOOL;\t\t\t\t// 门准备好\nEND_VAR\nVAR_IN_OUT\n\tTargetFloors\t\t:\tARRAY[0..3] OF BOOL;\t// 目标楼层数组\nEND_VAR\nVAR_OUTPUT\n\tbMovingUp\t\t\t:\tBOOL;\t\t\t\t// 向上移动\n\tbMovingDown\t\t\t:\tBOOL;\t\t\t\t// 向下移动\n\tbArrivedAtTarget\t:\tBOOL;\t\t\t\t// 到达目标楼层\nEND_VAR", "metadata": {"task_id": "elevator/1", "ground_truth": "FUNCTION_BLOCK FB_ElevatorMovement\nVAR_INPUT\n\tCurrentFloor\t\t:\tINT;\t\t\t\t// 当前楼层\n\tbDoorReady\t\t\t:\tBOOL;\t\t\t\t// 门准备好\nEND_VAR\nVAR_IN_OUT\n\tTargetFloors\t\t:\tARRAY[0..3] OF BOOL;\t// 目标楼层数组\nEND_VAR\nVAR_OUTPUT\n\tbMovingUp\t\t\t:\tBOOL;\t\t\t\t// 向上移动\n\tbMovingDown\t\t\t:\tBOOL;\t\t\t\t// 向下移动\n\tbArrivedAtTarget\t:\tBOOL;\t\t\t\t// 到达目标楼层\nEND_VAR\nVAR\n\tfbMoveDelayTimer\t:\tTON;\t\t\t\t// 移动延时定时器\n\ti\t\t\t\t\t:\tINT;\t\t\t\t// 循环变量\n\tbHasUpperRequest\t:\tBOOL;\t\t\t\t// 有更高楼层请求\n\tbHasLowerRequest\t:\tBOOL;\t\t\t\t// 有更低楼层请求\nEND_VAR\n\n// 检查是否到达目标楼层\nIF TargetFloors[CurrentFloor] THEN\n\tbArrivedAtTarget := TRUE;\n\tTargetFloors[CurrentFloor] := FALSE; // 清除请求\n\tbMovingUp := FALSE;\n\tbMovingDown := FALSE;\n\tRETURN;\nELSE\n\tbArrivedAtTarget := FALSE;\nEND_IF\n\n// 只有门准备好才能移动\nIF NOT bDoorReady THEN\n\tRETURN;\nEND_IF\n\n// 检查是否有更高楼层的请求\nbHasUpperRequest := FALSE;\nFOR i := CurrentFloor + 1 TO 3 DO\n\tIF TargetFloors[i] THEN\n\t\tbHasUpperRequest := TRUE;\n\t\tEXIT;\n\tEND_IF\nEND_FOR\n\n// 检查是否有更低楼层的请求\nbHasLowerRequest := FALSE;\nFOR i := CurrentFloor - 1 TO 0 BY -1 DO\n\tIF TargetFloors[i] THEN\n\t\tbHasLowerRequest := TRUE;\n\t\tEXIT;\n\tEND_IF\nEND_FOR\n\n// 移动逻辑\nIF bMovingUp OR (NOT bMovingDown AND bHasUpperRequest) THEN\n\t// 向上移动\n\tIF bHasUpperRequest THEN\n\t\tfbMoveDelayTimer(IN := TRUE, PT := T#500MS);\n\t\tIF fbMoveDelayTimer.Q THEN\n\t\t\tbMovingUp := TRUE;\n\t\t\tbMovingDown := FALSE;\n\t\t\tfbMoveDelayTimer(IN := FALSE);\n\t\tEND_IF\n\tELSE\n\t\t// 没有更高请求，改变方向\n\t\tbMovingUp := FALSE;\n\t\tIF bHasLowerRequest THEN\n\t\t\tbMovingDown := TRUE;\n\t\tEND_IF\n\tEND_IF\nELSIF bMovingDown OR (NOT bMovingUp AND bHasLowerRequest) THEN\n\t// 向下移动\n\tIF bHasLowerRequest THEN\n\t\tfbMoveDelayTimer(IN := TRUE, PT := T#500MS);\n\t\tIF fbMoveDelayTimer.Q THEN\n\t\t\tbMovingDown := TRUE;\n\t\t\tbMovingUp := FALSE;\n\t\t\tfbMoveDelayTimer(IN := FALSE);\n\t\tEND_IF\n\tELSE\n\t\t// 没有更低请求，改变方向\n\t\tbMovingDown := FALSE;\n\t\tIF bHasUpperRequest THEN\n\t\t\tbMovingUp := TRUE;\n\t\tEND_IF\n\tEND_IF\nELSE\n\t// 初始状态，默认向上\n\tIF bHasUpperRequest THEN\n\t\tbMovingUp := TRUE;\n\tELSIF bHasLowerRequest THEN\n\t\tbMovingDown := TRUE;\n\tEND_IF\nEND_IF", "fpath_tuple": ["FUN", "FB_ElevatorMovement.st"], "context_start_lineno": 0, "lineno": 14, "function_name": "FB_ElevatorMovement", "line_no": 14}}
{"_id": "elevator/2", "text": "FUNCTION F_DetectCurrentFloor : INT\nVAR_INPUT\n\tFloorSensor0\t:\tBOOL;\t\t// 0楼传感器\n\tFloorSensor1\t:\tBOOL;\t\t// 1楼传感器\n\tFloorSensor2\t:\tBOOL;\t\t// 2楼传感器\n\tFloorSensor3\t:\tBOOL;\t\t// 3楼传感器\n\tCurrentFloor\t:\tINT;\t\t// 当前楼层（用于保持状态）\nEND_VAR", "metadata": {"task_id": "elevator/2", "ground_truth": "FUNCTION F_DetectCurrentFloor : INT\nVAR_INPUT\n\tFloorSensor0\t:\tBOOL;\t\t// 0楼传感器\n\tFloorSensor1\t:\tBOOL;\t\t// 1楼传感器\n\tFloorSensor2\t:\tBOOL;\t\t// 2楼传感器\n\tFloorSensor3\t:\tBOOL;\t\t// 3楼传感器\n\tCurrentFloor\t:\tINT;\t\t// 当前楼层（用于保持状态）\nEND_VAR\n\n// 根据传感器输入确定当前楼层\nIF FloorSensor0 THEN \n\tF_DetectCurrentFloor := 0;\nELSIF FloorSensor1 THEN \n\tF_DetectCurrentFloor := 1;\nELSIF FloorSensor2 THEN \n\tF_DetectCurrentFloor := 2;\nELSIF FloorSensor3 THEN \n\tF_DetectCurrentFloor := 3;\nELSE\n\t// 没有传感器信号时，保持当前楼层\n\tF_DetectCurrentFloor := CurrentFloor;\nEND_IF", "fpath_tuple": ["FUN", "F_DetectCurrentFloor.st"], "context_start_lineno": 0, "lineno": 9, "function_name": "F_DetectCurrentFloor", "line_no": 9}}
{"_id": "elevator/3", "text": "FUNCTION F_RegisterCalls\nVAR_INPUT\n\tCallGround\t\t:\tBOOL;\t\t// 0楼呼叫\n\tCallFloor1\t\t:\tBOOL;\t\t// 1楼呼叫\n\tCallFloor2\t\t:\tBOOL;\t\t// 2楼呼叫\n\tCallFloor3\t\t:\tBOOL;\t\t// 3楼呼叫\nEND_VAR\nVAR_IN_OUT\n\tTargetFloors\t:\tARRAY[0..3] OF BOOL;\t// 目标楼层数组\nEND_VAR", "metadata": {"task_id": "elevator/3", "ground_truth": "FUNCTION F_RegisterCalls\nVAR_INPUT\n\tCallGround\t\t:\tBOOL;\t\t// 0楼呼叫\n\tCallFloor1\t\t:\tBOOL;\t\t// 1楼呼叫\n\tCallFloor2\t\t:\tBOOL;\t\t// 2楼呼叫\n\tCallFloor3\t\t:\tBOOL;\t\t// 3楼呼叫\nEND_VAR\nVAR_IN_OUT\n\tTargetFloors\t:\tARRAY[0..3] OF BOOL;\t// 目标楼层数组\nEND_VAR\n\n// 注册各楼层的呼叫请求\nIF CallGround THEN \n\tTargetFloors[0] := TRUE; \nEND_IF\n\nIF CallFloor1 THEN \n\tTargetFloors[1] := TRUE; \nEND_IF\n\nIF CallFloor2 THEN \n\tTargetFloors[2] := TRUE; \nEND_IF\n\nIF CallFloor3 THEN \n\tTargetFloors[3] := TRUE; \nEND_IF", "fpath_tuple": ["FUN", "F_RegisterCalls.st"], "context_start_lineno": 0, "lineno": 11, "function_name": "F_RegisterCalls", "line_no": 11}}
{"_id": "elevator/4", "text": "FUNCTION F_UpdateDoorAnimation : DINT\nVAR_INPUT\n\tbOpenDoor\t\t:\tBOOL;\t\t// 开门命令\n\tbCloseDoor\t\t:\tBOOL;\t\t// 关门命令\n\tbCallFloor\t\t:\tBOOL;\t\t// 该楼层有呼叫\n\tnCurrentAni\t\t:\tDINT;\t\t// 当前动画值\n\tnMaxAni\t\t\t:\tDINT := 70;\t// 最大动画值\nEND_VAR", "metadata": {"task_id": "elevator/4", "ground_truth": "FUNCTION F_UpdateDoorAnimation : DINT\nVAR_INPUT\n\tbOpenDoor\t\t:\tBOOL;\t\t// 开门命令\n\tbCloseDoor\t\t:\tBOOL;\t\t// 关门命令\n\tbCallFloor\t\t:\tBOOL;\t\t// 该楼层有呼叫\n\tnCurrentAni\t\t:\tDINT;\t\t// 当前动画值\n\tnMaxAni\t\t\t:\tDINT := 70;\t// 最大动画值\nEND_VAR\nVAR\n\tnNewAni\t\t\t:\tDINT;\t\t// 新的动画值\nEND_VAR\n\nnNewAni := nCurrentAni;\n\n// 开门动画（增加动画值）\nIF bOpenDoor AND nNewAni < nMaxAni AND bCallFloor THEN\n\tnNewAni := nNewAni + 1;\nEND_IF\n\n// 关门动画（减少动画值）\nIF bCloseDoor AND nNewAni > 0 THEN\n\tnNewAni := nNewAni - 1;\nEND_IF\n\nF_UpdateDoorAnimation := nNewAni;", "fpath_tuple": ["FUN", "F_UpdateDoorAnimation.st"], "context_start_lineno": 0, "lineno": 9, "function_name": "F_UpdateDoorAnimation", "line_no": 9}}
