{"_id": "plc_hello_mixing_tank/0", "text": "FUNCTION_BLOCK FB_AutoSequence\nVAR_INPUT\n\tbEnable\t\t\t\t:\tBOOL;\t\t\t// 使能自动序列\n\tbReset\t\t\t\t:\tBOOL;\t\t\t// 复位到排空状态\n\t\n\t// 液位传感器反馈\n\tbTankLevelFull\t\t:\tBOOL;\t\t\t// 液位满传感器\n\tbTankLevelEmpty\t\t:\tBOOL;\t\t\t// 液位空传感器\n\t\n\t// 设备状态反馈\n\tbMixerRunning\t\t:\tBOOL;\t\t\t// 混合电机运行中\n\tbMedium1Opened\t\t:\tBOOL;\t\t\t// 介质1阀门打开\n\tbMedium2Opened\t\t:\tBOOL;\t\t\t// 介质2阀门打开\n\tbDrainOpened\t\t:\tBOOL;\t\t\t// 排空阀门打开\n\t\n\t// 配置参数\n\ttMixingDuration\t\t:\tTIME := T#10S;\t// 混合持续时间\nEND_VAR\nVAR_OUTPUT\n\t// 设备控制输出\n\tbMixerRunCmd\t\t:\tBOOL;\t\t\t// 混合电机运行命令\n\tbMedium1OpenCmd\t\t:\tBOOL;\t\t\t// 介质1阀门打开命令\n\tbMedium2OpenCmd\t\t:\tBOOL;\t\t\t// 介质2阀门打开命令\n\tbDrainOpenCmd\t\t:\tBOOL;\t\t\t// 排空阀门打开命令\n\t\n\t// 状态输出\n\teCurrentState\t\t:\tAUTO_SEQUENCE;\t// 当前状态\n\tnCyclesCompleted\t:\tUINT;\t\t\t// 完成的循环次数\nEND_VAR", "metadata": {"task_id": "plc_hello_mixing_tank/0", "ground_truth": "FUNCTION_BLOCK FB_AutoSequence\nVAR_INPUT\n\tbEnable\t\t\t\t:\tBOOL;\t\t\t// 使能自动序列\n\tbReset\t\t\t\t:\tBOOL;\t\t\t// 复位到排空状态\n\t\n\t// 液位传感器反馈\n\tbTankLevelFull\t\t:\tBOOL;\t\t\t// 液位满传感器\n\tbTankLevelEmpty\t\t:\tBOOL;\t\t\t// 液位空传感器\n\t\n\t// 设备状态反馈\n\tbMixerRunning\t\t:\tBOOL;\t\t\t// 混合电机运行中\n\tbMedium1Opened\t\t:\tBOOL;\t\t\t// 介质1阀门打开\n\tbMedium2Opened\t\t:\tBOOL;\t\t\t// 介质2阀门打开\n\tbDrainOpened\t\t:\tBOOL;\t\t\t// 排空阀门打开\n\t\n\t// 配置参数\n\ttMixingDuration\t\t:\tTIME := T#10S;\t// 混合持续时间\nEND_VAR\nVAR_OUTPUT\n\t// 设备控制输出\n\tbMixerRunCmd\t\t:\tBOOL;\t\t\t// 混合电机运行命令\n\tbMedium1OpenCmd\t\t:\tBOOL;\t\t\t// 介质1阀门打开命令\n\tbMedium2OpenCmd\t\t:\tBOOL;\t\t\t// 介质2阀门打开命令\n\tbDrainOpenCmd\t\t:\tBOOL;\t\t\t// 排空阀门打开命令\n\t\n\t// 状态输出\n\teCurrentState\t\t:\tAUTO_SEQUENCE;\t// 当前状态\n\tnCyclesCompleted\t:\tUINT;\t\t\t// 完成的循环次数\nEND_VAR\nVAR\n\ttonMixing\t\t\t:\tTON;\t\t\t// 混合定时器\nEND_VAR\n\n// 复位逻辑\nIF bReset THEN\n\teCurrentState := AUTO_SEQUENCE.DRAINING;\n\tnCyclesCompleted := 0;\nEND_IF\n\n// 自动序列状态机\nIF bEnable THEN\n\tCASE eCurrentState OF\n\t\tAUTO_SEQUENCE.FILLING:\n\t\t\t// 确保其他设备不工作\n\t\t\tbMixerRunCmd := FALSE;\n\t\t\tbDrainOpenCmd := FALSE;\n\t\t\t\n\t\t\t// 打开两个介质阀门，开始填充罐体\n\t\t\tbMedium1OpenCmd := NOT bTankLevelFull;\n\t\t\tbMedium2OpenCmd := NOT bTankLevelFull;\n\t\t\t\n\t\t\t// 当罐体满时，等待填充阀关闭，然后进入混合状态\n\t\t\tIF bTankLevelFull AND NOT (bMedium1Opened OR bMedium2Opened) THEN\n\t\t\t\teCurrentState := AUTO_SEQUENCE.MIXING;\n\t\t\tEND_IF\n\t\t\t\n\t\tAUTO_SEQUENCE.MIXING:\n\t\t\t// 确保其他设备不工作\n\t\t\tbMedium1OpenCmd := FALSE;\n\t\t\tbMedium2OpenCmd := FALSE;\n\t\t\tbDrainOpenCmd := FALSE;\n\t\t\t\n\t\t\t// 启动混合电机并混合10秒\n\t\t\tbMixerRunCmd := TRUE;\n\t\t\ttonMixing(IN := bMixerRunning, PT := tMixingDuration);\n\t\t\t\n\t\t\t// 当定时器到达10秒，等待电机停止运行，然后进入排空状态\n\t\t\tIF tonMixing.Q THEN\n\t\t\t\tbMixerRunCmd := FALSE;\n\t\t\t\teCurrentState := AUTO_SEQUENCE.DRAINING;\n\t\t\tEND_IF\n\t\t\t\n\t\tAUTO_SEQUENCE.DRAINING:\n\t\t\t// 确保其他设备不工作\n\t\t\tbMixerRunCmd := FALSE;\n\t\t\tbMedium1OpenCmd := FALSE;\n\t\t\tbMedium2OpenCmd := FALSE;\n\t\t\t\n\t\t\t// 打开排空阀，开始排空罐体\n\t\t\tbDrainOpenCmd := NOT bTankLevelEmpty;\n\t\t\t\n\t\t\t// 当罐体空时，等待排空阀关闭，然后进入填充状态\n\t\t\tIF bTankLevelEmpty AND NOT bDrainOpened THEN\n\t\t\t\teCurrentState := AUTO_SEQUENCE.FILLING;\n\t\t\t\tnCyclesCompleted := nCyclesCompleted + 1;\n\t\t\tEND_IF\n\tEND_CASE\nELSE\n\t// 禁用时，关闭所有输出\n\tbMixerRunCmd := FALSE;\n\tbMedium1OpenCmd := FALSE;\n\tbMedium2OpenCmd := FALSE;\n\tbDrainOpenCmd := FALSE;\n\ttonMixing(IN := FALSE);\nEND_IF", "fpath_tuple": ["FUN", "FB_AutoSequence.st"], "context_start_lineno": 0, "lineno": 30, "function_name": "FB_AutoSequence", "line_no": 30}}
{"_id": "plc_hello_mixing_tank/1", "text": "FUNCTION_BLOCK FB_ManualControl\nVAR_INPUT\n\t// HMI命令输入\n\tbMixerRunCmd\t\t:\tBOOL;\n\tbMixerStopCmd\t\t:\tBOOL;\n\tbMedium1OpenCmd\t\t:\tBOOL;\n\tbMedium1CloseCmd\t:\tBOOL;\n\tbMedium2OpenCmd\t\t:\tBOOL;\n\tbMedium2CloseCmd\t:\tBOOL;\n\tbDrainOpenCmd\t\t:\tBOOL;\n\tbDrainCloseCmd\t\t:\tBOOL;\n\t\n\t// 设备反馈输入\n\tbMixerRunning\t\t:\tBOOL;\n\tbMedium1Opened\t\t:\tBOOL;\n\tbMedium2Opened\t\t:\tBOOL;\n\tbDrainOpened\t\t:\tBOOL;\nEND_VAR\nVAR_OUTPUT\n\t// 设备控制输出\n\tbMixerRunCmdOut\t\t:\tBOOL;\n\tbMedium1OpenCmdOut\t:\tBOOL;\n\tbMedium2OpenCmdOut\t:\tBOOL;\n\tbDrainOpenCmdOut\t:\tBOOL;\nEND_VAR", "metadata": {"task_id": "plc_hello_mixing_tank/1", "ground_truth": "FUNCTION_BLOCK FB_ManualControl\nVAR_INPUT\n\t// HMI命令输入\n\tbMixerRunCmd\t\t:\tBOOL;\n\tbMixerStopCmd\t\t:\tBOOL;\n\tbMedium1OpenCmd\t\t:\tBOOL;\n\tbMedium1CloseCmd\t:\tBOOL;\n\tbMedium2OpenCmd\t\t:\tBOOL;\n\tbMedium2CloseCmd\t:\tBOOL;\n\tbDrainOpenCmd\t\t:\tBOOL;\n\tbDrainCloseCmd\t\t:\tBOOL;\n\t\n\t// 设备反馈输入\n\tbMixerRunning\t\t:\tBOOL;\n\tbMedium1Opened\t\t:\tBOOL;\n\tbMedium2Opened\t\t:\tBOOL;\n\tbDrainOpened\t\t:\tBOOL;\nEND_VAR\nVAR_OUTPUT\n\t// 设备控制输出\n\tbMixerRunCmdOut\t\t:\tBOOL;\n\tbMedium1OpenCmdOut\t:\tBOOL;\n\tbMedium2OpenCmdOut\t:\tBOOL;\n\tbDrainOpenCmdOut\t:\tBOOL;\nEND_VAR\n\n// 手动模式：HMI命令通过锁存器控制设备\n// 锁存逻辑：按下启动OR已启动反馈 AND NOT 按下停止\n\n// 混合电机控制\nbMixerRunCmdOut := (bMixerRunCmd OR bMixerRunning) AND NOT bMixerStopCmd;\n\n// 介质1阀门控制\nbMedium1OpenCmdOut := (bMedium1OpenCmd OR bMedium1Opened) AND NOT bMedium1CloseCmd;\n\n// 介质2阀门控制\nbMedium2OpenCmdOut := (bMedium2OpenCmd OR bMedium2Opened) AND NOT bMedium2CloseCmd;\n\n// 排空阀门控制\nbDrainOpenCmdOut := (bDrainOpenCmd OR bDrainOpened) AND NOT bDrainCloseCmd;", "fpath_tuple": ["FUN", "FB_ManualControl.st"], "context_start_lineno": 0, "lineno": 26, "function_name": "FB_ManualControl", "line_no": 26}}
{"_id": "plc_hello_mixing_tank/2", "text": "FUNCTION_BLOCK FB_ModeController\nVAR_INPUT\n\tbSetToAuto\t\t:\tBOOL;\t// 切换到自动模式命令\n\tbSetToManual\t:\tBOOL;\t// 切换到手动模式命令\nEND_VAR\nVAR_OUTPUT\n\teCurrentMode\t:\tMODES;\t// 当前模式\n\tbModeChanged\t:\tBOOL;\t// 模式改变标志\nEND_VAR", "metadata": {"task_id": "plc_hello_mixing_tank/2", "ground_truth": "FUNCTION_BLOCK FB_ModeController\nVAR_INPUT\n\tbSetToAuto\t\t:\tBOOL;\t// 切换到自动模式命令\n\tbSetToManual\t:\tBOOL;\t// 切换到手动模式命令\nEND_VAR\nVAR_OUTPUT\n\teCurrentMode\t:\tMODES;\t// 当前模式\n\tbModeChanged\t:\tBOOL;\t// 模式改变标志\nEND_VAR\nVAR\n\teLastMode\t\t:\tMODES;\t// 上次模式\nEND_VAR\n\n// 模式切换逻辑\nCASE eCurrentMode OF\n\tMODES.AUTO:\n\t\tIF bSetToManual THEN\n\t\t\teCurrentMode := MODES.MANUAL;\n\t\tEND_IF\n\t\t\n\tMODES.MANUAL:\n\t\tIF bSetToAuto THEN\n\t\t\teCurrentMode := MODES.AUTO;\n\t\tEND_IF\nEND_CASE\n\n// 检测模式变化\nbModeChanged := (eCurrentMode <> eLastMode);\neLastMode := eCurrentMode;", "fpath_tuple": ["FUN", "FB_ModeController.st"], "context_start_lineno": 0, "lineno": 10, "function_name": "FB_ModeController", "line_no": 10}}
{"_id": "plc_hello_mixing_tank/3", "text": "FUNCTION_BLOCK FB_TankLevelSimulator\nVAR_INPUT\n\tbMedium1Opened\t\t:\tBOOL;\t\t\t// 介质1阀门打开\n\tbMedium2Opened\t\t:\tBOOL;\t\t\t// 介质2阀门打开\n\tbDrainOpened\t\t:\tBOOL;\t\t\t// 排空阀门打开\n\tbReset\t\t\t\t:\tBOOL;\t\t\t// 复位到初始液位\n\t\n\t// 配置参数\n\trInitialLevel\t\t:\tREAL := 25.0;\t// 初始液位 (%)\n\trFillRate1\t\t\t:\tREAL := 0.1;\t// 介质1填充速率 (%/cycle)\n\trFillRate2\t\t\t:\tREAL := 0.1;\t// 介质2填充速率 (%/cycle)\n\trDrainRate\t\t\t:\tREAL := 0.2;\t// 排空速率 (%/cycle)\n\trMinLevel\t\t\t:\tREAL := 0.0;\t// 最小液位 (%)\n\trMaxLevel\t\t\t:\tREAL := 100.0;\t// 最大液位 (%)\nEND_VAR\nVAR_OUTPUT\n\trCurrentLevel\t\t:\tREAL;\t\t\t// 当前液位 (%)\nEND_VAR", "metadata": {"task_id": "plc_hello_mixing_tank/3", "ground_truth": "FUNCTION_BLOCK FB_TankLevelSimulator\nVAR_INPUT\n\tbMedium1Opened\t\t:\tBOOL;\t\t\t// 介质1阀门打开\n\tbMedium2Opened\t\t:\tBOOL;\t\t\t// 介质2阀门打开\n\tbDrainOpened\t\t:\tBOOL;\t\t\t// 排空阀门打开\n\tbReset\t\t\t\t:\tBOOL;\t\t\t// 复位到初始液位\n\t\n\t// 配置参数\n\trInitialLevel\t\t:\tREAL := 25.0;\t// 初始液位 (%)\n\trFillRate1\t\t\t:\tREAL := 0.1;\t// 介质1填充速率 (%/cycle)\n\trFillRate2\t\t\t:\tREAL := 0.1;\t// 介质2填充速率 (%/cycle)\n\trDrainRate\t\t\t:\tREAL := 0.2;\t// 排空速率 (%/cycle)\n\trMinLevel\t\t\t:\tREAL := 0.0;\t// 最小液位 (%)\n\trMaxLevel\t\t\t:\tREAL := 100.0;\t// 最大液位 (%)\nEND_VAR\nVAR_OUTPUT\n\trCurrentLevel\t\t:\tREAL;\t\t\t// 当前液位 (%)\nEND_VAR\n\n// 复位逻辑\nIF bReset THEN\n\trCurrentLevel := rInitialLevel;\nEND_IF\n\n// 液位计算\n// 如果任一填充阀打开则填充，如果排空阀打开则排空\nrCurrentLevel := rCurrentLevel\n\t\t\t\t+ rFillRate1 * BOOL_TO_REAL(bMedium1Opened)\n\t\t\t\t+ rFillRate2 * BOOL_TO_REAL(bMedium2Opened)\n\t\t\t\t- rDrainRate * BOOL_TO_REAL(bDrainOpened);\n\n// 限制液位范围 (0-100%)\nrCurrentLevel := LIMIT(rMinLevel, rCurrentLevel, rMaxLevel);", "fpath_tuple": ["FUN", "FB_TankLevelSimulator.st"], "context_start_lineno": 0, "lineno": 19, "function_name": "FB_TankLevelSimulator", "line_no": 19}}
{"_id": "plc_hello_mixing_tank/4", "text": "FUNCTION F_ResetDeviceCommands : BOOL\nVAR_IN_OUT\n\t// HMI命令标志（需要复位）\n\tbMixerRunCmd\t\t:\tBOOL;\n\tbMixerStopCmd\t\t:\tBOOL;\n\tbMedium1OpenCmd\t\t:\tBOOL;\n\tbMedium1CloseCmd\t:\tBOOL;\n\tbMedium2OpenCmd\t\t:\tBOOL;\n\tbMedium2CloseCmd\t:\tBOOL;\n\tbDrainOpenCmd\t\t:\tBOOL;\n\tbDrainCloseCmd\t\t:\tBOOL;\nEND_VAR\nVAR_INPUT\n\t// 设备状态反馈\n\tbMixerRunning\t\t:\tBOOL;\n\tbMedium1Opened\t\t:\tBOOL;\n\tbMedium2Opened\t\t:\tBOOL;\n\tbDrainOpened\t\t:\tBOOL;\nEND_VAR", "metadata": {"task_id": "plc_hello_mixing_tank/4", "ground_truth": "FUNCTION F_ResetDeviceCommands : BOOL\nVAR_IN_OUT\n\t// HMI命令标志（需要复位）\n\tbMixerRunCmd\t\t:\tBOOL;\n\tbMixerStopCmd\t\t:\tBOOL;\n\tbMedium1OpenCmd\t\t:\tBOOL;\n\tbMedium1CloseCmd\t:\tBOOL;\n\tbMedium2OpenCmd\t\t:\tBOOL;\n\tbMedium2CloseCmd\t:\tBOOL;\n\tbDrainOpenCmd\t\t:\tBOOL;\n\tbDrainCloseCmd\t\t:\tBOOL;\nEND_VAR\nVAR_INPUT\n\t// 设备状态反馈\n\tbMixerRunning\t\t:\tBOOL;\n\tbMedium1Opened\t\t:\tBOOL;\n\tbMedium2Opened\t\t:\tBOOL;\n\tbDrainOpened\t\t:\tBOOL;\nEND_VAR\n\n// 命令合理性复位\n// 当设备到达目标状态时，复位相应的命令标志\n\n// 混合电机命令复位\nIF bMixerRunning THEN\n\tbMixerRunCmd := FALSE;\t\t// 已运行，复位运行命令\nELSE\n\tbMixerStopCmd := FALSE;\t\t// 已停止，复位停止命令\nEND_IF\n\n// 介质1阀门命令复位\nIF bMedium1Opened THEN\n\tbMedium1OpenCmd := FALSE;\t// 已打开，复位打开命令\nELSE\n\tbMedium1CloseCmd := FALSE;\t// 已关闭，复位关闭命令\nEND_IF\n\n// 介质2阀门命令复位\nIF bMedium2Opened THEN\n\tbMedium2OpenCmd := FALSE;\t// 已打开，复位打开命令\nELSE\n\tbMedium2CloseCmd := FALSE;\t// 已关闭，复位关闭命令\nEND_IF\n\n// 排空阀门命令复位\nIF bDrainOpened THEN\n\tbDrainOpenCmd := FALSE;\t\t// 已打开，复位打开命令\nELSE\n\tbDrainCloseCmd := FALSE;\t// 已关闭，复位关闭命令\nEND_IF\n\nF_ResetDeviceCommands := TRUE;", "fpath_tuple": ["FUN", "F_ResetDeviceCommands.st"], "context_start_lineno": 0, "lineno": 20, "function_name": "F_ResetDeviceCommands", "line_no": 20}}
{"_id": "plc_hello_mixing_tank/5", "text": "FUNCTION F_UpdateLimitSwitches : BOOL\nVAR_INPUT\n\trTankLevel\t\t\t:\tREAL;\t\t\t// 当前液位 (%)\n\trFullThreshold\t\t:\tREAL := 85.0;\t// 满液位阈值 (%)\n\trEmptyThreshold\t\t:\tREAL := 5.0;\t// 空液位阈值 (%)\nEND_VAR\nVAR_OUTPUT\n\tbLevelFull\t\t\t:\tBOOL;\t\t\t// 液位满开关\n\tbLevelEmpty\t\t\t:\tBOOL;\t\t\t// 液位空开关\nEND_VAR", "metadata": {"task_id": "plc_hello_mixing_tank/5", "ground_truth": "FUNCTION F_UpdateLimitSwitches : BOOL\nVAR_INPUT\n\trTankLevel\t\t\t:\tREAL;\t\t\t// 当前液位 (%)\n\trFullThreshold\t\t:\tREAL := 85.0;\t// 满液位阈值 (%)\n\trEmptyThreshold\t\t:\tREAL := 5.0;\t// 空液位阈值 (%)\nEND_VAR\nVAR_OUTPUT\n\tbLevelFull\t\t\t:\tBOOL;\t\t\t// 液位满开关\n\tbLevelEmpty\t\t\t:\tBOOL;\t\t\t// 液位空开关\nEND_VAR\n\n// 液位开关模拟\nbLevelFull := rTankLevel >= rFullThreshold;\t\t// 液位 >= 85% 时，满开关激活\nbLevelEmpty := rTankLevel <= rEmptyThreshold;\t// 液位 <= 5% 时，空开关激活\n\nF_UpdateLimitSwitches := TRUE;", "fpath_tuple": ["FUN", "F_UpdateLimitSwitches.st"], "context_start_lineno": 0, "lineno": 11, "function_name": "F_UpdateLimitSwitches", "line_no": 11}}
