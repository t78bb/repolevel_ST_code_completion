{
  "library": "MQTT Client SL",
  "title": "MQTTClient (FunctionBlock)",
  "url": "https://content.helpme-codesys.com/en/libs/MQTT Client SL/Current/MQTT-Client/Common/Function-Blocks/MQTTClient.html",
  "page_title": "MQTTClient (FB)",
  "text": "\nFUNCTION_BLOCK MQTTClient EXTENDS CBML.LCon\nFunction block to connect with a MQTT broker\n",
  "tables": [
    {
      "headers": [
        "Scope",
        "Name",
        "Type",
        "Initial",
        "Comment",
        "Inherited from"
      ],
      "rows": [
        {
          "Scope": "Input",
          "Name": "xEnable",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "TRUE: Activates the defined operationFALSE: Aborts/resets the defined operation",
          "Inherited from": "LCon"
        },
        {
          "Scope": "Output",
          "Name": "xDone",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "TRUE: Ready condition reached",
          "Inherited from": "LCon"
        },
        [
          "xBusy",
          "BOOL",
          "",
          "TRUE: Operation is running",
          "LCon"
        ],
        [
          "xError",
          "BOOL",
          "",
          "TRUE: Error condition reached",
          "LCon"
        ],
        {
          "Scope": "Input",
          "Name": "uiPort",
          "Type": "UINT",
          "Initial": "",
          "Comment": "Port of MQTT Broker Server",
          "Inherited from": ""
        },
        [
          "xUseTLS",
          "BOOL",
          "",
          "Obsolete, use itfTLSContext instead !TRUE: Crypted Connection, FALSE: Uncrypted Connection",
          ""
        ],
        [
          "uiKeepAlive",
          "UINT",
          "5",
          "Keep Alive Time in Seconds (optional)",
          ""
        ],
        [
          "pbWillMessage",
          "POINTER TO BYTE",
          "0",
          "Pointer to the âLast Willâ message (optional)",
          ""
        ],
        [
          "uiWillMessageSize",
          "UINT",
          "0",
          "Size of âLast Willâ message (optional)",
          ""
        ],
        [
          "xWillRetain",
          "BOOL",
          "",
          "TRUE: Saves the âLast Willâ message on server. If Client\nsubscribes later, then it receives the last stack message\nfrom server.",
          ""
        ],
        [
          "eWillQoS",
          "MQTT_QOS",
          "",
          "QoS Level of âLast Willâ message",
          ""
        ],
        [
          "xCleanSession",
          "BOOL",
          "",
          "TRUE: Creates a new session, FALSE: Uses already existing\nsession if available",
          ""
        ],
        [
          "wsUsername",
          "WSTRING(255)",
          "ââ",
          "User Name (optional)",
          ""
        ],
        [
          "wsPassword",
          "WSTRING(1024)",
          "ââ",
          "User Password (optional)",
          ""
        ],
        [
          "wsWillTopic",
          "WSTRING(1024)",
          "ââ",
          "Will Topic (optional)",
          ""
        ],
        [
          "sClientId",
          "STRING(255)",
          "ââ",
          "Client ID, if empty then new ID is generated, allowed are\nonly these characters\n0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\n(optional)",
          ""
        ],
        [
          "tPingInterval",
          "TIME",
          "TIME#2s0ms",
          "Interval time in seconds how often should be pinged, if\nTime<=0 then no pings",
          ""
        ],
        [
          "hCert",
          "RTS_IEC_HANDLE",
          "RTS_INVALID_HANDLE",
          "Obsolete, use itfTLSContext instead !Handle to the client certificate (optional)",
          ""
        ],
        [
          "itfTLSContext",
          "NBS.ITLSContext",
          "0",
          "Encapsulates all the data neccecray to handle encrypted tcp connectionsStatic initialization, as shown in the following code snippet.VARcommonName:STRING:='MyRrasPi';ciCertInfo:NBS.CERT_INFO:=(psInfo:=ADR(commonName),udiSize:=LEN(commonName));myTLSContext:NBS.TLSContext:=(ePurpose:=NBS.PURPOSE.CLIENT_SIDE,sUseCaseName:='NBSTest',sTLSVersion:='1.3',ciCertInfo:=ciCertInfo,udiVerificationMode:=2);END_VAR",
          ""
        ],
        [
          "itfAsyncProperty",
          "NBS.IAsyncProperty",
          "0",
          "Runs the connect process in a own background task.\nUse this property if the connection setup takes longer than one task cycle (e.g. TLS connections)",
          ""
        ],
        [
          "udiTimeOut",
          "UDINT",
          "0",
          "Defines the time (Âµs) after which the connection setup\naborts with xError.",
          ""
        ],
        [
          "eCommunicationMode",
          "COMMUNICATION_MODE",
          "COMMUNICATION_MODE.TCP",
          "Communication mode: TCP or WEB_SOCKET, default: TCPCOMMUNICATION_MODE.TCP: Configure the connection via the inputs: sHostname, uiPort and itfTLSContextCOMMUNICATION_MODE.WEB_SOCKET: Configure the connection via the inputs: sWebSocketUrl and itfTLSContextAdditional WebSocket options can be set via the methodSetWebSocketOptions.",
          ""
        ],
        [
          "sWebSocketUrl",
          "REFERENCE TO STRING(1024)",
          "",
          "The uri of the websocket server. e.g âws://localhost:8080â\nws-URI = âws:â â//â host [ â:â port ] path [ â?â query ]\nwss-URI = âwss:â â//â host [ â:â port ] path [ â?â query ]The input is only relevant for eCommunicationMode = COMMUNICATION_MODE.WEB_SOCKET.",
          ""
        ],
        [
          "eMQTTVersion",
          "MQTT_VERSION",
          "MQTT_VERSION.V3_1_1",
          "MQTT protocol version, default: 3.1.1",
          ""
        ],
        [
          "mQTTConnectProperties",
          "REFERENCE TOMQTTConnectProperties",
          "",
          "Connection properties for MQTT V5",
          ""
        ],
        [
          "mQTTWillProperties",
          "REFERENCE TOMQTTWillProperties",
          "",
          "Will properties for MQTT V5",
          ""
        ],
        {
          "Scope": "Inout Const",
          "Name": "sHostname",
          "Type": "STRING(80)",
          "Initial": "",
          "Comment": "Host name of Broker MQTT Server (is IPAddress)",
          "Inherited from": ""
        },
        {
          "Scope": "Output",
          "Name": "eMQTTError",
          "Type": "MQTT_ERROR",
          "Initial": "",
          "Comment": "MQTT Error Type",
          "Inherited from": ""
        },
        [
          "xConnectedToBroker",
          "BOOL",
          "FALSE",
          "FALSE when there is no Connection to MQTT Broker Server,\notherwise TRUE",
          ""
        ],
        [
          "eReaonCode",
          "MQTT_REASON_CODE",
          "",
          "Reason code of the last operation (MQTT V5 only)",
          ""
        ],
        [
          "mQTTConnackProperties",
          "MQTTConnackProperties",
          "",
          "Connection response properties (MQTT V5 only)",
          ""
        ]
      ]
    }
  ]
}