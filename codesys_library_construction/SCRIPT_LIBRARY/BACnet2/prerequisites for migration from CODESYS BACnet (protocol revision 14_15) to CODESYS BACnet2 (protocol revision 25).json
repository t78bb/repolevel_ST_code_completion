{
  "library": "BACnet2",
  "title": "prerequisites for migration from CODESYS BACnet (protocol revision 14/15) to CODESYS BACnet2 (protocol revision 25)",
  "url": "https://content.helpme-codesys.com/en/libs/BACnet2/Current/Doc/migrationrst.html#prerequisites-for-migration-from-codesys-bacnet-protocol-revision-14-15-to-codesys-bacnet2-protocol-revision-25",
  "page_title": "migration from CODESYS BACnet (protocol revision 14/15) to CODESYS BACnet2 (protocol revision 25)",
  "text": "\nSignificant effort had been spend to make migration from CODESYS BACnet (protocol revision 14/15) to CODESYS BACnet2 (protocol revision >=25) as easy as possible\nand to avoid unneccessary changes in application code. The goal was to allow a simple migration of a good part of existing CODESYS BACnet applications with a very small amount of code changes - or even without code changes.\nOn the other hand - releasing a new major version of a product is a good chance and also a commitment to cleanup API issues of older versions.\nMigration from CODESYS BACnet (protocol revision 14/15) to CODESYS BACnet2 (protocol revision >=25) may require some application code changes described hereafter - depending on the API aspects used by the application.\nPlease also note: changing the BACnet protocol revision of an already certified BACnet device is not for free regarding the BACnet certificate - there is a need to BTL conformance testing and certification again,\nso in fact it turns out to be kind of a brand new BACnet device.\nprerequisites for migration from CODESYS BACnet (protocol revision 14/15) to CODESYS BACnet2 (protocol revision 25)\nÂ¶\nAs described in the âparts and piecesâ section there is a need for the runtime component CmpBACnet to run CODESYS BACnet.\nCODESYS BACnet2 requires the runtime component CmpBACnet2 to be existent on the PLC and and to be configured appropriately.\nFor details about CmpBACnet2 configuration please refer to the CODESYS BACnet2 online dcoumentation section âBACnet Configuration in the Runtimeâ.\nmodifications of application code required by type changes of âevent STRUCTsâ\nÂ¶\nCODESYS BACnet works with extensively with âhooksâ and âcallbacksâ implemented using events and âevent STRUCTsâ EVT_BACNET_*.\nIn CODESYS BACnet up to version 1.7.*.* (respectively in CmpBACnet used in conjuction with this older versions of CODESYS BACnet) those âevent STRUCTsâ\nhad been manually created matching their BACnet-Stack counterparts in a binary-compatible way.\nThis approach was rated to cumbersome and error prone, and had been replaced by generating them (CmpBACnet2.EVT_BACNET_*) from the BACnet-Stack information.\nWithin the BACnet-Stack âprotocol revision 25â some member names of âhookâ / âcallbackâ arguments had been changed for consistency (compared as with BACnet-Stack âprotocol revision 14/15â).\nThis leads to name changes on âevent STRUCTâ members thus forcing the need of changes in application code migrating from CODESYS BACnet 1.7.*.* to âCODESYS BACnet2â.\nmodifications of application code required by API change regarding problematic simultaneous property access\nÂ¶\nCODESYS BACnet up to version 1.7.*.* did a bit too much for convenience in some place, not taking all implications into account.\nFor the following object types exceptional âtwo properties simultaneous accessâ had been put in place, to write two properties simultaneously.\nThe initial thought about this was to ensure consistency of the number of elements in both properties - which is required by the BACnet standard.\nThis exceptional âtwo properties simultaneous accessâ had been implemented for:\nâCommandâ (Object Type) properties Action and Action_Text\nâGlobal Groupâ properties Group_Members and Group_Member_Names\nâStructured Viewâ  (Object Type) properties Subordinate_List and Subordinate_Annotations\nnot taking into account:\nthe second property is stated âoptionalâ in the BACnet standard, so can be configured ânot existentâ if needed rendering the API broken\nclients might write those properties using simple write-property-requests (instead write-property-multiple-requests)\nso for sure breaking the consistency of number of elements at least for a certain slot in time.\nGetting a value with âtwo properties simultaneous accessâ API will fail on that.\nIn fact this âtwo properties simultaneous accessâ had been meant to be a convenience, but turned out to be a hazzle.\nSo it had been replaced by standard âproperty accessâ API thus forcing the need of changes in application code migrating from CODESYS BACnet 1.7.*.* to âCODESYS BACnet2â.\nmodifications of application code required by API changes done for consistency cleanup\nÂ¶\nAs explained in section âapplication programming interfaceâ -> âBACnet objectsâ the âproperty accessâ is using data types defined in CmpBACnet2 in most cases, only some aspects of âproperty accessâ use IEC-61311 standard types for convenience.\nThis rule had not been obeyed in CODESYS BACnet up to version 1.7.*.* in some places and had been cleaned up for consistency:\nâDevice objectâ properties Last_Restore_Time and Time_Of_Device_Restart used type BACnetTimeStamp (instead CmpBACnet.IEC_BACNET_TIME_STAMP)\nto provide some convenience, but breaking consistency with other properties of type CmpBACnet.IEC_BACNET_TIME_STAMP.\nSo both properties had beed changed to CmpBACnet.IEC_BACNET_TIME_STAMP, please use conversion functions\nInitializeBACnetTimeStamp\nand\nFromBACnetTimeStamp\nif needed.\nMost likely your application should not contain code related to those properties, because BAcnetDefaultImpl.library provides the necessary functionality ready-to-use in BackupRestore, DeviceDateTime and ReinitDevice_SvcAppHook.\nBACnetDeviceObjectPropertyReference vs. CmpBACnet.IEC_BACNET_DEV_OBJ_PROP_REFERENCE\nSome object / property combination used BACnetDeviceObjectPropertyReference instead CmpBACnet.IEC_BACNET_DEV_OBJ_PROP_REFERENCE for a little convenience,\ndeclaring BACnetDeviceObjectPropertyReference.fDevicePresent as BOOL instead IEC_BACNET_DEV_OBJ_PROP_REFERENCE.fDevicePresent as IEC_BACNET_BOOLEAN.\nBACnetDeviceObjectPropertyReference had been removed from the API and had been replace by CmpBACnet.IEC_BACNET_DEV_OBJ_PROP_REFERENCE in\nâAveragingâ Object_Property_Reference\nâGlobal Groupâ Group_Members (modifications of application code needed also because of âproblematic simultaneous property accessâ see above)\nâEvent Enrollmentâ Object_Property_Reference\nâScheduleâ List_Of_Object_Property_References\nâTrend Logâ Log_DeviceObjectProperty\nâTrend Log Multipleâ Log_DeviceObjectProperty\nBACnetARRAY[] of\nand\nBACnetLIST of\nproperties API cleanup\nIn CODESYS BACnet up to version 1.7.*.*\nproperty access\nof\nBACnetARRAY[] of\nand\nBACnetLIST of\nproperties had been inconsistent,\nconfusing container type (array vs. list) access semantics and naming - this was to be cleaned up.\nThe old\nproperty access\nhad been kept for compatibility if possible and marked {attribute âobsoleteââ¦} so you might notice warnings.\nThose âcompatibility aliasâ parts of the API will be removed in future versions, so you better cleanup your application code early on.\nAlso index-based operations had been confused within CODESYS BACnet up to version 1.7.*.*.\nThe BACnet-Standard defines that\nBACnetARRAY[] of\ncontains the number of elements in the array in element[0] as UNSIGNED,\nso element access is using index 1 .. number of elements at the wire.\nThe BACnet-Standard doesnt define index-based operations for\nBACnetLIST of\n.\nCODESYS BACnet up to version 1.7.*.* tried to implement index-based operations for some\nBACnetLIST of\nproperties at extreme costs.\nThose costs result from two apects:\nto get an element from a\nBACnetLIST of\nproperty the whole content had to be retreived and the element had to be extracted\nif the\nBACnetLIST of\nproperty is of complex type containing\nSEQUENCE\nâs the whole content data had to be stored away until application code did a\n|FreeStackAllocatedMemory|\nof the element data,\nbecause the element data refer to data contained in the whole content data\nAs with CODESYS BACnet2 this approach had been changed to cleanup the API:\nindex-based operations do use index 0 .. number of elements - 1 consistently for\nBACnetARRAY[] of\nand\nBACnetLIST of\nproperties\nthe number of elements can be obtained using GetCount()\nBACnetLIST of\nproperties doesnt provide GetElement() semantics\nmost API METHODs of CODESYS BACnet API up to version 1.7.*.* dealing with\nBACnetARRAY[] of\nand\nBACnetLIST of\nproperties\nhad been marked as {attribute âobsoleteââ¦} - you should replace those calls with the mentioned replacement, they still compile and work properly for now, but will be removed in future versions.\nAPI METHODs of CODESYS BACnet API up to version 1.7.*.* dealing with\nBACnetLIST of\ngetElement semantics had been removed without any substitute.\nUse GetContent() to get the whole content data and process this appropriatly.\nMost parts of the API of CODESYS BACnet up to version 1.7.*.* plagued with this issues could be redirected to the new API.\nThose parts had been marked as {attribute âobsoleteââ¦} - you should replace those calls with the mentioned replacement, they still compile and work properly for now, but will be removed in future versions.\nUnfortunatley one part of the parts of the API of CODESYS BACnet up to version 1.7.*.* plagued with this issues could not be saved this way, so Calendar.GetEntry was removed - use Calendar.GetContent and work this way.\nAPI differences between CODESYS BACnet up to version 1.7.*.* and CODESYS BACnet2\nÂ¶\nHere the list of changes which require modifications of application code caused by API cleanup (sorted by function block / property / method):\nAveraging.ObjectPropertyReference type changed from BACnetDevObjPropReference to CmpBACnet.IEC_BACNET_DEV_OBJ_PROP_REFERENCE\nCalendar.GetEntry removed - use Calendar.GetContent and process property content accordingly\nDevice.LastRestoreTime type changed from BACnetTimeStamp to CmpBACnet.IEC_BACNET_TIME_STAMP\nDevice.SerialNumber type changed from STRING to WSTRING(255)\nDevice.TimeOfDeviceRestart type changed from BACnetTimeStamp to CmpBACnet.IEC_BACNET_TIME_STAMP\nDevice.GetAutoSlaveDiscovery removed because this property was removed from the BACnet-Standard\nDevice.GetManualSlaveAddressBinding removed because this property was removed from the BACnet-Standard\nDevice.GetSlaveAddressBinding removed because this property was removed from the BACnet-Standard\nDevice.GetSlaveProxyEnable removed because this property was removed from the BACnet-Standard\nDevice.SetAutoSlaveDiscovery removed because this property was removed from the BACnet-Standard\nDevice.SetManualSlaveAddressBinding removed because this property was removed from the BACnet-Standard\nDevice.SetSlaveAddressBinding removed because this property was removed from the BACnet-Standard\nDevice.SetSlaveProxyEnable removed because this property was removed from the BACnet-Standard\nEventEnrollment.ObjectPropertyReference type changed from BACnetDevObjPropReference to CmpBACnet.IEC_BACNET_DEV_OBJ_PROP_REFERENCE\nSchedule.GetPropertyReference removed - use ObjectPropertyReferences.GetContent and process property content accordingly\nSchedule.AddWeeklyEntry removed - use WeeklySchedule accordingly\nSchedule.GetWeeklyEntry removed - use WeeklySchedule accordingly\nSchedule.GetWeeklyEntryCount removed - use WeeklySchedule accordingly\nSchedule.GetWeeklySchedule removed - use WeeklySchedule accordingly\nSchedule.RemoveWeeklyEntry removed - use WeeklySchedule accordingly\nTrendLog.LogDeviceObjectProperty type changed from BACnetDevObjPropReference to CmpBACnet.IEC_BACNET_DEV_OBJ_PROP_REFERENCE\nPlease be aware, that additional parts of CODESYS BACnet API up to version 1.7.*.* had be marked as {attribute âobsoleteââ¦}.\nYou should replace calls to those methods or properties with the replacement mentioned - they still compile and work properly for now, but will be removed in future versions.\nrecommended modifications of application code regarding âhooksâ / âcallbacksâ event âevent STRUCTâ typenames and event-IDâs\nÂ¶\nCODESYS BACnet works with extensively with âhooksâ and âcallbacksâ implemented using events, âevent STRUCTsâ (plus event-IDâs, event-parameter-IDâs and event-version).\nIn CODESYS BACnet up to version 1.7.*.* (respectively in CmpBACnet used in conjuction with this older versions of CODESYS BACnet) the whoel had been inconsistent regarding naming\nand had been cleaned up / made consistent in CODESYS BACnet2.\nAppropriate âcompatibility aliasâ had been put in place to make it possible to migrate to CODESYS BACnet2 without the need to change code regarding those aspects.\nSo âoldâ âevent STRUCTâ type names as well as old event-IDâs, event-parameter-IDâs and event-version can be used.\nOf course it is recommended to change application code regarding those aspects. The âcompatibility aliasâ carry {attribute âobsoleteââ¦} so you might notice warnings.\nThose âcompatibility aliasâ parts of the API will be removed in future versions, so you better cleanup your application code.\nhint regarding BACnetARRAY[N] ordering\nÂ¶\nCODESYS BACnet up to version 1.7.*.* ignored the fact that the BACnet standard states, that a âBACnetARRAYâ datatype is a structured datatype consisting of an ordered sequence of data elements, each having the same datatype.\nSo the sematic Get??? / Get???Count / Add??? (to end of array) / Remove??? (at given position) chosen in older versions of CODESYS BACnet did not fullfill the BACnet standard completely.\nFor most pratical use this was relevant, but had to cleaned up as with âCODESYS BACnet2â - so a method Insert??? had been added.\nPlease consider using this method if array element ordering is of any relevance for your application.\ntop\nCODESYS Group | We\nsoftware\nAutomation.\nto software\n['sɒftwɛər]\ntransitive verb\n__softwared/softwaring\n: to develop software\n// to software automation: to develop software for automation purposes\nThe CODESYS Group is the manufacturer of CODESYS, the leading hardware-independent\n                                    IEC 61131-3 automation software for developing and engineering controller\n                                    applications.\nCODESYS® is a registered trademark.\nCODESYS GmbH\nA member of the CODESYS Group\nMemminger Straße 151, 87439 Kempten\nGermany\nTel.:\n+49-831-54031-0\ninfo@codesys.com\nLegal Notice\nPrivacy Policy\nLinkedIn\nYoutube\nRSS\nDownloads\nLogin\nCODESYS Store\n© 2022 CODESYS GmbH\n| A member of the CODESYS Group",
  "tables": []
}