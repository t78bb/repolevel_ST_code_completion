{
  "library": "SM3_CNC",
  "title": "SMC_NCInterpreter (FunctionBlock)",
  "url": "https://content.helpme-codesys.com/en/libs/SM3_CNC/Current/SM_CNC_POUs/NC2/Interpreter/SMC_NCInterpreter.html",
  "page_title": "SMC_NCInterpreter (FB)",
  "text": "\nFUNCTION_BLOCK FINAL SMC_NCInterpreter\nThis function block is used to interpret a CNC program\n(Din 66025, G-code).\nThe program is converted into a list of\nSMC_GeoInfo\nobjects\nand stored in a queue of type\nSMC_OutQueue\n.\nIn each call, usually one line of the program is interpreted.\nThis function block should be called in a separate task with\na priority lower than the priority of the bus task.\nIt should be called together with the function blocks for reading\nthe G-Code (e.g.\nSMC_ReadNCFile2\n) and for pre-processing the path\n(e.g.\nSMC_CheckVelocities\n).\nIt can be called multiple times per cycle.\nNote\nThe interpreter must be called in the same task as the function block\nthat fills the SMC_GSentenceQueue (input\nsentences\n).\nUsually, the sentences are provided by\nSMC_ReadNCFile2\n,\nSMC_ReadNCFromStream\n, or\nSMC_NCTokenParser\n.\nThe maximum number of M-functions in a row is 64.\nIf the G-Code contains more than 64 M-functions in a row,\nthe error\nSMC_DEC_OUTQUEUE_RAN_EMPTY\noccurs.\nThis restriction can be circumvented by inserting a G75\nprevious to the first M-function of the sequence.\nG4-elements count as M-functions, too.\n",
  "tables": [
    {
      "headers": [
        "Scope",
        "Name",
        "Type",
        "Initial",
        "Comment"
      ],
      "rows": [
        {
          "Scope": "Inout",
          "Name": "sentences",
          "Type": "SMC_GSentenceQueue",
          "Initial": "",
          "Comment": "The input queue of g-code sentences"
        },
        {
          "Scope": "Input",
          "Name": "bExecute",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "Execution starts on the rising edge."
        },
        [
          "bAbort",
          "BOOL",
          "",
          "IfTRUE, the current processing of this function block\nis aborted"
        ],
        [
          "bAppend",
          "BOOL",
          "",
          "The inputbAppendis intended for the use-case of appending a further\nG-Code file to the last one, keeping the interpreter state.\nThe result is the same as if both G-Code files would have been copied into\na single file, with a few exceptions as mentioned below.\nThe out-queue is not cleared, only the bEndOfData flag is reset.\nState like the decoder coordinate system (G54, G55, G56),\nthe arc coordinate system (G15, G16, G17, G18, G19), the\ncurrent mode (G90, G91, G98, G99), or the implicit variable is kept and\nused for the new G-Code.Note that when reading the G-Code withSMC_ReadNCFile2orSMC_ReadNCFromStream, the input âbAppendâ of these function blocks\nmust be set, too.Restrictions:The first rising edge ofbExecutemust havebAppend=FALSE,\notherwise the errorSMC_CNC_APPEND_ON_FIRST_RISING_EDGEis returend.Splines (G05/G10) cannot be continued.  If the first G-Code ends with\na spline, and the following G-Code starts with a spline, a spline stop\nis done at the end of the previous G-Code, nevertheless.The inputspiStartPositionandvStartToolLengthare ignored ifbAppendisTRUE."
        ],
        [
          "piStartPosition",
          "SMC_POSINFO",
          "",
          "Start position of the path. Only the position of the axes\n(piStartPosition.dX/dY/dZ/dA/dB/dC/dA1/â¦/dA6) is used, the other\nmembers of piStartPosition are ignored.\nThe start position is read at a rising edge of execute, and when\na G31 / PROBE movement is finished.\nIt is recommended to useSMC_SetInterpreterStartPositionto copy\nthe actual position of the machine from the bus task to the task\nof the interpreter."
        ],
        [
          "vStartToolLength",
          "SMC_Vector3d",
          "",
          "Start tool length."
        ],
        [
          "nSizeOutQueue",
          "UDINT",
          "",
          "This variable contains the size of the data buffer,\nthe list ofSMC_GEOINFOstructure objects will be written to.\nThis buffer must be able to hold at least fiveSMC_GEOINFOobjects.\nOtherwise, the function block will not execute any actions at all.\nIts size may be predefined, but may be modified later only\nduring a reset.\nIt is recommended to create the buffer as described by the example below:ExampleBuf:Array[1..50]ofSMC_GeoInfo;The appropriate buffer size will then be retrieved by use of the\noperatorsizeof(ExampleBuf)."
        ],
        [
          "pbyBufferOutQueue",
          "POINTER TO ARRAY [0..0]\nOF SMC_GEOINFO",
          "",
          "This input must point to the first byte of the memory area\nthat is allocated for theSMC_OUTQUEUEstructure.\nThis area must be at least as big as defined innSizeOutQueue.\nTypically the allocation of the memory buffer is done in the\ndeclaration part of the IEC-program by defining an array ofSMC_GEOINFO(e.g.BUF:ARRAY[1..50]OFSMC_GEOINFO; for a buffer that can\nstore 50 path elements). The value may be predefined, but may be\nmodified later on only during a reset."
        ],
        [
          "bEnableSyntaxChecks",
          "BOOL",
          "TRUE",
          "Turns on syntax checks that will detect invalid G-code and\nstop with an error in this case.  It is recommended to\nuse the syntax checks."
        ],
        [
          "eOriConv",
          "SMC_ORI_CONVENTION",
          "SMC_ORI_CONVENTION.ADDAXES",
          "Defines the way the orientation in the A/B/C words is interpreted.For movement commands (such as G01, G02, â¦), the value determines\nhow A/B/C are treated.  For values other thanSMC_ORI_CONVENTION.``ADDAXES``, the angles A/B/C may be normalized,\neven if no coordinate rotation has been programmed.  For example with\norientation convention ZYZ, a programmed orientation of A=90Â° B=0Â° C=0Â°\nmay result in the (equivalent) rotation A=0Â° B=0Â° C=90Â° in the path\nelement.For commands that set the decoder coordinate system (G54/G55/G56),\nthe value determines how the coordinates A/B/C are treated.\nIf the value isSMC_ORI_CONVENTION.``ADDAXES``, then A/B/C are\ntreated as independent additional axes, for which offsets are set.\nFor all other values, A/B/C are treated as an orientation, and the\ndecoder coordinate system is rotated accordingly.NoteIf used with tool correction functions such asSMC_ToolLengthCorr, the same orientation convention has to\nbe used there."
        ],
        [
          "dCircleTolerance",
          "LREAL",
          "",
          "Tolerance to decide whether the definition of a circle makes sense.case definition via target-position and radius:\nIf the distance between start- and end-position\n(both projected onto the circle plane) is greater than2*theradius+MAX(fCircleTolerance,1e-06),\nthe circle will be converted into a line.case definition via target- and center-position:\nLetxbe the maximum of\nthe distance between start- and center-position and\nthe distance between target- and center-position\n(projecting everything onto the circle plane).\nIf those distances differ by more thanMAX(fCircleTolerance,0.1*x),\nthe circle will be converted into a line."
        ],
        [
          "pInterpreterStack",
          "POINTER TO BYTE",
          "",
          "Allows to supply a buffer for the interpreter stack.  If 0, a default buffer\nof size 10240 Bytes is used.  If <> 0, the given buffer will be used.\nThis input is read each cycle."
        ],
        [
          "nInterpreterStackSizeBytes",
          "UDINT",
          "",
          "The size of the buffer pointed to by pInterpreterStack.  Note that the size\nneeds to be at least 1024 Bytes."
        ],
        [
          "dPrecision",
          "LREAL",
          "",
          "The precision of the path in technical units.\nThis value indicates the precision of the positions\nread from the G-Code.  For example, if the G-Code is\ngiven with 3 places after the decimal point, the precision\nshould be set to 1e-3 units.\nThe precision must be non-negative.The precision value is used for example by path preprocessors likeSMC_ToolRadiusCorrandSMC_AvoidLoop."
        ],
        {
          "Scope": "Output",
          "Name": "bDone",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "This variable will be set toTRUEas soon as the\ninput data has been processed completely.\nThe function block will not perform any further actions\nuntil it gets reset."
        },
        [
          "bBusy",
          "BOOL",
          "",
          "TRUE, while execution of function block is not finished."
        ],
        [
          "bError",
          "BOOL",
          "",
          "Signals that an error has occurred within the function\nblock."
        ],
        [
          "wErrorID",
          "SMC_ERROR",
          "",
          "Error identification"
        ],
        [
          "errorPos",
          "SMC_NC_SourcePosition",
          "",
          "The source-position where an error has been detected."
        ],
        [
          "poqDataOut",
          "POINTER TOSMC_OUTQUEUE",
          "",
          "Pointer to theSMC_OUTQUEUEstructure that manages the\ndecodedSMC_GEOINFOobjects."
        ],
        [
          "iStatus",
          "SMC_DEC_STATUS",
          "",
          "The current status."
        ],
        [
          "iLineNumberDecoded",
          "DINT",
          "",
          "The variable contains the 0-based line number of the CNC\nfile."
        ],
        [
          "GCodeText",
          "SMC_GCODE_TEXT",
          "",
          "The G-Code text of the current line."
        ],
        [
          "CallstackInfo",
          "SMC_NCCallstackInfo",
          "",
          "Information about the callstack of the current\nG-Code line.  Used bySMC_DisplayNCCallstack."
        ],
        [
          "aActivePrograms",
          "ARRAY\n[0..(SoftMotion_NC2_Constants.IPR_CALLSTACK_SIZE\n- 1)] OF STRING",
          "",
          "The currently active programs and subprograms.\naActivePrograms[0] holds the name of the (sub)program that is\ncurrently interpreted.  If it is a sub-program, then\naActivePrograms[1] holds the name of the calling (sub)program\nand so on.\nThe list of active programs is terminated by an empty string."
        ]
      ]
    }
  ]
}