{
  "library": "SM3_CNC",
  "title": "SMC_SmoothPath (FunctionBlock)",
  "url": "https://content.helpme-codesys.com/en/libs/SM3_CNC/Current/SM_CNC_POUs/SoftMotion-CNC/SoftMotion-Function-Blocks/SMC_SmoothPath.html",
  "page_title": "SMC_SmoothPath (FB)",
  "text": "\nFUNCTION_BLOCK SMC_SmoothPath\nSMC_SmoothPath\nsmoothes corners between adjacent elements by inserting\nsplines.  See\nSMC_RoundPath\nfor an alternative corner rounding\nwith circular arcs.\nThe cut distance, the distance between the start or end of the spline and\nthe corner, is always limited to the sum of\ndEdgeDistance\nand the value\nof the g-code word\nD\n.\nIf input\nbSymmetricalDistances\nis set, the cut distance is further\nlimited to the minimum of half the length of the first element and\nhalf the length of the second element.\nIf the sum of input variable\ndEdgeDistance\nand G-code word\nD\nis 0,\nthen no smoothing is done.\nIf one of the two elements is a G0 element, then no smoothing is done.\nDetails\nAll\nSMC_GEOINFO\nelements of the input structure\nSMC_OUTQUEUE\nare checked one after the other. The smooth-path functionality is\nexecuted for all elements between G51 and G50.\nM-function at the smoothed corner\nIf there is a M-function at the corner that will be smoothed, then the\nM-function remains but is moved to the end of the smoothed corner.\nThis behavior is consistent with the behavior of\nSMC_RoundPath\n.\nH-function at a smoothed corner\nIf there is a H-function bewtween the first cut point and the corner\n(1), the point is moved to the smoothed path (1â).\nThe distance to the start point remains the same.\nIf there a H-function between the corner and the second cut point\n(3) the point is also moved to the smoothed path (3â),\nso that the distance to the end point remains the same.\nThe position of the moved H-functions is limited so that they donât\ncross the center of smoothed path. Otherwise the order of the H-functions\nmight change (2â, 4â).\nExample 1: Smoothing with splines\nG-Code\nN000 G01 X10 Y0 F100\nN010 G51 D2 (smoothing with cut distance 2)\nN020 G01 X10 Y20\nN030 G01 X20 Y20\nN040 G01 X20 Y0\nN050 G50 (smoothing off)\nN060 G01 X30\nThe following figure shows a path with smoothed corners. The smoothing is\nturned on at position X10 Y0 and is turned off at position X20 Y0.\nAll corners between these positions are replaced by splines.\nExample 2: Input bSymmetricalDistances\nG-Code\nN000 G01 X10 Y0 F100\nN010 G51 D10 (smoothing with cut distance 2)\nN020 G01 X10 Y20\nN030 G01 X20 Y20\nN040 G01 X20 Y0\nN050 G50 (smoothing off)\nN060 G01 X30\nThe example shows the result when the cut distance\nis larger than half of the element. The following figure shows the\nresulting path with\nbSymmetricalDistances\n=\nFALSE\n.\nThe element is too short, so it is completely replaced by two\nsplines.\nIn the following figure\nbSymmetricalDistances\nis set, together\nwith\nbImprovedSymmetricCuts\n.  At both\ncorners, half the length of the horizontal line limits the cut\ndistance to 5.\nExample 3: Input eMode\nG-Code\nN000 G51 D10 (smoothing with cut distance 10)\nN010 G01 X0 Y10\nN020 G01 X10 Y10\nN030 G01 X10 Y0\nN040 G50 (smoothing off)\nThe default spline type for smoothing is\nSP_SPLINE3\n, i.e. a\nthird-degree polynomial in each dimension.\nIt is recommended to use\nSP_SPLINE5_MIN_CURVATURE\n.\nFifth-degree polynomials have the advantage that they are smooth up to\nthe curvature (second derivative).\nThis results in a limited jerk.\nDynamic curves along the X-axis with eMode = SP_SPLINE3\nDynamic curves along the X-axis with eMode = SP_SPLINE5\nA smoothing element always uses the tool correction information\n(i.e. lengths and diameter) of the preceding element.\nNote\nPROBE movements such as G31 are not supported. The error\nSMC_PROBE_G31_NOT_ALLOWED\nis reported if a PROBE movement\nis encountered while corner smoothing active.\n",
  "tables": [
    {
      "headers": [
        "Scope",
        "Name",
        "Type",
        "Initial",
        "Comment"
      ],
      "rows": [
        {
          "Scope": "Input",
          "Name": "bExecute",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "Starts on rising edge."
        },
        [
          "bAbort",
          "BOOL",
          "",
          "IfTRUE, the current processing of this function block\nis aborted"
        ],
        [
          "bAppend",
          "BOOL",
          "",
          "As long as this input is set toFALSE, thepoqDataOutqueue\nwill be cleared at each reset. As long as it is set toTRUE, newly\nincoming data will be written to the end of thepoqDataOut-queue."
        ],
        [
          "poqDataIn",
          "POINTER TOSMC_OUTQUEUE",
          "",
          "The input path queue"
        ],
        [
          "dEdgeDistance",
          "LREAL",
          "",
          "This input variable contains the value, which â added to the value of\ntheDword â determines the (maximum) cut distance to the corner.\nThis value may be modified online."
        ],
        [
          "dAngleTol",
          "LREAL",
          "0.001",
          "This input defines the value for the angle tolerance, up to which\na path bend should not be smoothed."
        ],
        [
          "nSizeOutQueue",
          "UDINT",
          "",
          "This variable contains the size of the data bufferpbyBufferOutQueuein bytes.The list ofSMC_GEOINFOstructure objects will be written to.\nThis buffer must be large enough to hold at least fiveSMC_GEOINFOobjects.\nOtherwise, the function block will not execute any actions at all.\nIts size may be predefined, but may be modified later only during a reset.\nIt is recommended to create the buffer as described by the example below:ExampleBuf:ARRAY[1..50]OFSMC_GeoInfo;The correct buffer size will then be retrieved by use of the\noperatorsizeof(ExampleBuf)."
        ],
        [
          "pbyBufferOutQueue",
          "POINTER TO ARRAY [0..0]\nOF SMC_GEOINFO",
          "",
          "This input must point to the first byte of the memory area being\nallocated for theSMC_OUTQUEUEstructure.\nThis area must be at least as big as defined innSizeOutQueue.\nTypically the allocation of the memory buffer is done within the\ndeclaration part of the IEC-program by defining a byte-array\n(ExampleBuf:ARRAY[1..50]OFSMC_GEOINFO;).\nThe value may be predefined, but may then be modified during a reset only."
        ],
        [
          "eMode",
          "SMC_SMOOTHPATHMODE",
          "SP_SPLINE3",
          "Determines which kind of spline is used for smoothing.\nIt is recommended to useSMC_SMOOTHPATHMODE.SP_SPLINE5_MIN_CURVATURE."
        ],
        [
          "bSymmetricalDistances",
          "BOOL",
          "TRUE",
          "IfbSymmetricalDistancesis set, the cut distance is limited\nto half the length of the shorter element.  Otherwise the cut distance\ndefined in theDword is used."
        ],
        [
          "bImprovedSymmetricCuts",
          "BOOL",
          "",
          "IfbSymmetricalDistancesis set, the first element is cut at most in half.\nIf the optionbImprovedSymmetricCutsis set, this limitation is lifted.\nIn some cases this results in a better smoothing.  Only has an effect ifbSymmetricalDistancesis set.\nIt is recommended to set this input toTRUEifbSymmetricalDistancesis set."
        ],
        [
          "eAddAxMode",
          "SMC_SMOOTHPATHADDAXMODE",
          "SPAA_LATE",
          "The way how additional axis are treated.\nIfSMC_SmoothMergeis used, this parameter should be set\nto modeSPAA_EXACT."
        ],
        [
          "dMinimumCurvatureRadius",
          "LREAL",
          "",
          "If a spline, that would be inserted in a edge, contains a position\nwhere its curvature radius is less than this parameter, this edge is not\nsmoothed.  In this situation no spline is inserted, but the original path is\nmaintained and a stop is executed in the edge."
        ],
        [
          "bCheckCurvature",
          "BOOL",
          "",
          "IfTRUE, it is checked if the curvature of adjacent elements is equal.\nIf this is not the case, the path will be smoothed."
        ],
        [
          "dRelativeCurvatureTol",
          "LREAL",
          "0.001",
          "The maximum allowed relative difference in the curvature.\nOnly used ifbCheckCurvatureisTRUE."
        ],
        [
          "bCheckAddAxVelJump",
          "BOOL",
          "",
          "IfTRUEthe axis A, B and C are checked for velocity jumps.\nShould be set ifSMC_SmoothMergeis used."
        ],
        [
          "dMaxAddAxVelDifference",
          "LREAL",
          "",
          "The maximum allowed velocity jump [units/sec]. This input is evaluated ifbCheckAddAxVelJumpisTRUE. Recommended:maxAcceleration*taskCycleTime"
        ],
        {
          "Scope": "Output",
          "Name": "bDone",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "This output will be set toTRUEas soon as the input data frompoqDataInhas been processed completely.\nThereafter, the module will not perform any further actions until it gets reset.\nIf inputbExecuteisFALSE,bDonewill be reset toFALSE."
        },
        [
          "bBusy",
          "BOOL",
          "",
          "TRUE, while execution of function block is not finished"
        ],
        [
          "bError",
          "BOOL",
          "",
          "Signals, that an error has occurred within the function\nblock"
        ],
        [
          "wErrorID",
          "SMC_ERROR",
          "",
          "Error identification"
        ],
        [
          "poqDataOut",
          "POINTER TOSMC_OUTQUEUE",
          "",
          "The output path queue"
        ],
        [
          "udiStopsDueToCurvatureRadius",
          "UDINT",
          "",
          "Number of edges that could not be smoothed because of thedMinimumCurvatureRadiussetting"
        ]
      ]
    }
  ]
}