{
  "library": "SM3_CNC",
  "title": "SMC_SmoothMerge (FunctionBlock)",
  "url": "https://content.helpme-codesys.com/en/libs/SM3_CNC/Current/SM_CNC_POUs/SoftMotion-CNC/SoftMotion-Function-Blocks/SMC_SmoothMerge.html",
  "page_title": "SMC_SmoothMerge (FB)",
  "text": "GlobalTextList (GlobalTextList)\nImagePool_cnc_sm3 (ImagePool)\nImages\nLibrary Information\nGetLibVersion (Function)\nGetLibVersionNumber (Function)\nIsLibReleased (Function)\nProjektinformationen\nGetBooleanProperty (Function)\nGetCompany (Function)\nGetNumberProperty (Function)\nGetTextProperty (Function)\nGetTextProperty2 (Function)\nGetTitle (Function)\nGetVersion (Function)\nGetVersionProperty (Function)\nSM3_CNC_GetVersion (Function)\nSMC_CNC_LibParams (ParamList)\nSM_CNC_Data types\nFile\nSMC_SINGLEVAR (Struct)\nSMC_TOKENTYPE (Enum)\nSMC_VARLIST (Struct)\nSMC_VARTYPE (Enum)\nSoftMotion CNC\nSMC_ABC_SLOPES_AT_STOP (Enum)\nSMC_ABC_SLOPES_NO_STOP (Enum)\nSMC_ADDAXIS (Enum)\nSMC_AL_STATUS (Enum)\nSMC_CNC_REF (FunctionBlock)\nSMC_DEC_STATUS (Enum)\nSMC_DIRECTION (Enum)\nSMC_GAddress (Alias)\nSMC_GCODEVIEWER_DATA (Struct)\nSMC_GCODE_TEXT (Struct)\nSMC_GCODE_WORD (Struct)\nSMC_GCodeObjectId (Struct)\nSMC_GEOINFO (Struct)\nSMC_GWord (Struct)\nSMC_INT_STATUS (Enum)\nSMC_INT_VELMODE (Enum)\nSMC_LINE_3D (Struct)\nSMC_MOVTYP (Enum)\nSMC_M_PARAMETERS (Struct)\nSMC_OBJECTSPLITTERMODE (Enum)\nSMC_ORI_CONVENTION (Enum)\nSMC_OUTQUEUE (FunctionBlock)\nbFull (Property)\nSMC_PLANE_H (Struct)\nSMC_POSINFO (Struct)\nSMC_SEGMENT (Struct)\nSMC_SEGMENTTYPE (Enum)\nSMC_SMOOTHBSPLINE_MODE (Enum)\nSMC_SMOOTHPATHADDAXMODE (Enum)\nSMC_SMOOTHPATHMODE (Enum)\nSMC_Seg (Struct)\nSMC_TC_STATUS (Enum)\nSMC_TOOLCORRMODE (Enum)\nSMC_VECTOR6D (Struct)\nSM_CNC_POUs\nFile\nReadNCFile\nSMC_ReadNCFile (FunctionBlock)\nStream\nToken\nSMC_ReadNCQueue (FunctionBlock)\nCloseFile (Action)\nhelp functions\nSMC_StringBuffer (FunctionBlock)\nNC2\nGSentence\nSMC_GExpToken_Iterator (FunctionBlock)\nSMC_GJUMP_COMMAND (Enum)\nSMC_GJUMP_TARGET (Union)\nSMC_GSentence (Struct)\nSMC_GSentenceQueue (FunctionBlock)\nSMC_GSentence_DynCall (Struct)\nSMC_GSentence_GWords (Struct)\nSMC_GSentence_GWords_Create (Function)\nSMC_GSentence_Iterator (FunctionBlock)\nSMC_GSentence_Let (Struct)\nSMC_GSentence_SubCall (Struct)\nSMC_GSentence_SubRet (Struct)\nSMC_GSentence_Type (Enum)\nSMC_GSentence_Union (Union)\nSMC_GVarDecl (Struct)\nSMC_GVar_Type (Enum)\nSMC_GWord_Iterator (FunctionBlock)\nSMC_NC_CopySentence (Function)\nSMC_NC_CopySentenceChecked (Function)\nGSentenceJumpBuffer\nSMC_GSentenceJumpBuffer (FunctionBlock)\nInterpreter\nCallstack\nSMC_NCInterpreter (FunctionBlock)\nParser\nExpressions\nSMC_NCTokenParser (FunctionBlock)\nSMC_NC_SourcePosition (Struct)\nSymbolTable\nReadNCFile2\nSMC_IGSentenceModifier (Interface)\nSMC_INCLookup (Interface)\nSMC_ITokenModifier (Interface)\nSMC_NCLookupFile (FunctionBlock)\nSMC_NCNavigator (FunctionBlock)\nSMC_NC_CanProcessTokens (Function)\nSMC_NC_FindProgramFile (Function)\nSMC_NC_PrependDefaults (FunctionBlock)\nSMC_NC_TokenQueue_Completed (Function)\nSMC_ReadNCFile2 (FunctionBlock)\nSMC_ReadNCFromStream (FunctionBlock)\nSoftMotion CNC\nCoordinate Transformations\nSMC_CoordinateTransformation3D (FunctionBlock)\nSMC_DetermineCuboidBearing (FunctionBlock)\nSMC_InvCoordinateTransformation3D (FunctionBlock)\nSMC_TeachCoordinateSystem (FunctionBlock)\nSMC_UnitVectorToRPY (FunctionBlock)\nDirect Axis Control\nSMC_ControlAxisByPos (FunctionBlock)\nSMC_ControlAxisByPosVel (FunctionBlock)\nSMC_ControlAxisByVel (FunctionBlock)\nGCode Viewer\nSMC_GCodeViewer (FunctionBlock)\nGeoInfo Help Functions\nSMC_AdaptHelpMarks (Function)\nSMC_CalcEndPnt (Function)\nSMC_CalcLengthGeo (Function)\nSMC_CalcStartPnt (Function)\nSMC_CutEnd (Function)\nSMC_CutStart (Function)\nSMC_GeoinfoInit (Function)\nSMC_GetAccVec (Function)\nSMC_GetAddAxValue (Function)\nSMC_GetClosestPnt (Function)\nSMC_GetLengthOfPrefix (Function)\nSMC_GetPnt (Function)\nSMC_GetPntPI (Function)\nSMC_GetTanVec (Function)\nSMC_GetTanVec3D (Function)\nSMC_InvertDirection (Function)\nSMC_RampInCorr (Function)\nSMC_RampOutCorr (Function)\nSMC_RecalculateHelpMarks (Function)\nSMC_SingleCorr (Function)\nOutQueue Functions\nSMC_AppendObj (Function)\nSMC_DeleteObj (Function)\nSMC_GetCount (Function)\nSMC_GetHistoryCount (Function)\nSMC_GetLastObj (Function)\nSMC_GetObj (Function)\nSMC_GetObjFromEnd (Function)\nSMC_GetObjFromHistory (Function)\nSMC_OutQueueInit (Function)\nSMC_OutQueueIsSyncing (Function)\nSMC_OutQueue_IsFull (Function)\nSMC_RestoreQueue (Function)\nSMC_SetObj (Function)\nSMC_SetQueueCapacity (Function)\nPosinfo Functions\nSMC_PosInfo_Trf_Inverse (Function)\nSMC_PosInfo_Trf_Mult (Function)\nQueue manipulation\nSMC_QueueSetReservedEntries (FunctionBlock)\nSMC_RotateQueue2D (FunctionBlock)\nSMC_ScaleQueue3D (FunctionBlock)\nSMC_TranslateQueue3D (FunctionBlock)\nSoftMotion Function Blocks\nBlockSearch\nDecoderBuffer\nInterpolator_Help_Functions\nM_Functions\nNCDecoder_Help_Functions\nSMC_AddGCodeState (Struct)\nSMC_AvoidLoop (FunctionBlock)\nSMC_CheckForLimits (FunctionBlock)\nSMC_CheckVelocities (FunctionBlock)\nSMC_ExtendedVelocityChecks (FunctionBlock)\nSMC_Interpolator (FunctionBlock)\nSMC_Interpolator2Dir (FunctionBlock)\nSMC_Interpolator2Dir_SlowTask (FunctionBlock)\nSMC_LimitCircularVelocity (FunctionBlock)\nSMC_LimitDynamics (FunctionBlock)\nSMC_NCDecoder (FunctionBlock)\nSMC_ObjectSplitter (FunctionBlock)\nSMC_ReadAdditionalIpoState (FunctionBlock)\nSMC_RecomputeABCSlopes (FunctionBlock)\nSMC_ReduceVelEndAtCorner (FunctionBlock)\nSMC_RoundPath (FunctionBlock)\nSMC_SegmentAnalyzer (FunctionBlock)\nSMC_SetInterpreterStartPosition (FunctionBlock)\nSMC_SmoothAddAxes (FunctionBlock)\nSMC_SmoothBSpline (FunctionBlock)\nSMC_SmoothMerge (FunctionBlock)\nSMC_SmoothPath (FunctionBlock)\nSMC_ToolCorr (FunctionBlock)\nSMC_ToolLengthCorr (FunctionBlock)\nSMC_ToolRadiusCorr (FunctionBlock)\nSMC_XInterpolator (FunctionBlock)\nSM_Trafo_Data types\nSMC_ArticulatedRobot_6DOF_J0_State (Enum)\nSMC_ArticulatedRobot_6DOF_J1_State (Enum)\nSMC_ArticulatedRobot_6DOF_J4_State (Enum)\nSMC_TrafoConfig_4AxisPalletizer (Struct)\nSMC_TrafoConfig_ArticulatedRobot_6DOF (Struct)\nSMC_TrafoResult_4AxisPalletizer (Enum)\nSMC_TrafoResult_ArticulatedRobot_6DOF (Enum)\nSMC_VECTORDIR (Enum)\nSM_Trafo_POUs\nForward and inverse transformation\nSMC_TRAFOV_\nSoftMotion Transformations\nGantry systems\nParallel Systems\nRobot Kinematiks\nScara System\nWrapper\nadditional FBs\nVisu_Templates\nFile\nCNC\nSM_CNC_Visualizations\nFBs\nCNC\nDirect Axis Control\nTranslation & Rotation & Scaling\nhelp visu\nSM_Trafo_Visualizations\nTrafo templates\nGantry\nParallel\nRobot\nScara\nVisu_Templates_New\nFramed Visu Helpers\nTextListForCombobox_MC_DIRECTION (TextList)\nTextListForCombobox_SMC_ABC_SLOPES_AT_STOP (TextList)\nTextListForCombobox_SMC_ABC_SLOPES_NO_STOP (TextList)\nTextListForCombobox_SMC_AL_STATUS (TextList)\nTextListForCombobox_SMC_DEC_STATUS (TextList)\nTextListForCombobox_SMC_DIRECTION (TextList)\nTextListForCombobox_SMC_ERROR (TextList)\nTextListForCombobox_SMC_INT_STATUS (TextList)\nTextListForCombobox_SMC_INT_VELMODE (TextList)\nTextListForCombobox_SMC_ORI_CONVENTION (TextList)\nTextListForCombobox_SMC_SMOOTHBSPLINE_MODE (TextList)\nTextListForCombobox_SMC_SMOOTHPATHADDAXMODE (TextList)\nTextListForCombobox_SMC_SMOOTHPATHMODE (TextList)\nTextListForCombobox_SMC_TC_STATUS (TextList)\nTextListForCombobox_SMC_TOOLCORRMODE (TextList)\nFile and Project Information\nLibrary Reference\n3SLicense\nLibrary Identification\nLibrary Properties\nBase Interfaces\nLibrary Identification\nLibrary Properties\nCmpLog\nLibrary Identification\nLibrary Properties\nFloatingPointUtils\nLibrary Identification\nLibrary Properties\nMatrix\nLibrary Identification\nLibrary Properties\nSM3_Basic\nLibrary Identification\nLibrary Properties\nLibrary Parameter\nSM3_RBase\nLibrary Identification\nLibrary Properties\nSM3_Shared\nLibrary Identification\nLibrary Properties\nSM3_Transformation\nLibrary Identification\nLibrary Properties\nStandard\nLibrary Identification\nLibrary Properties\nSysFile\nLibrary Identification\nLibrary Properties\nSysMem\nLibrary Identification\nLibrary Properties\nSysTarget\nLibrary Identification\nLibrary Properties\nSysTypes2 Interfaces\nLibrary Identification\nLibrary Properties\nVisuElem3DPath\nLibrary Identification\nLibrary Properties\nLibrary Parameter\nVisuElemCamDisplayer\nLibrary Identification\nLibrary Properties\nLibrary Parameter\nVisuElemMeter\nLibrary Identification\nLibrary Properties\nVisuElemTextEditor\nLibrary Identification\nLibrary Properties\nVisuElemTrace\nLibrary Identification\nLibrary Properties\nVisuElems\nLibrary Identification\nLibrary Properties\nVisuElemsAlarm\nLibrary Identification\nLibrary Properties\nVisuElemsDateTime\nLibrary Identification\nLibrary Properties\nVisuElemsSpecialControls\nLibrary Identification\nLibrary Properties\nVisuElemsWinControls\nLibrary Identification\nLibrary Properties\nVisuInputs\nLibrary Identification\nLibrary Properties\nVisuNativeControl\nLibrary Identification\nLibrary Properties\nSM3_CNC\nDocs\n»\nSM_CNC_POUs\n»\nSoftMotion\nCNC\n»\nSoftMotion\nFunction\nBlocks\n»\nSMC_SmoothMerge (FB)\nSMC_SmoothMerge (FB)\nÂ¶\nFUNCTION_BLOCK SMC_SmoothMerge\nThe function block serves the preprocessing of line segments supplied by a CAD/CAM\nsystem. It is executed after decoding. It tries to approximate a\nmaximum number of points by a polynom. The deviation from the original path must be\nwithin a given threshold. The created elements can be smoothed by use of the SMC_SmoothPath\nfunction block.\nIn each cycle this function block appends a maximum of one element to the out-queue.\nExactly one element is appended if the in-queue is full or\nbEndOfList\nis active and\nthe out-queue is not full. The look-ahead is therefore limited by the size of the\nin-queue. Only movements in X, Y, Z, A, B and C are considered.\nThe function block uses the mean-square-best-approximation, but always pass exactly\nthrough one first point (for avoiding jumps). This first point is given by the\npiDestPos\nof the last generated element. If it is the first element that we deal with, this is its\npiStartPos\n.\nOnly the following movement types can be merged:\nAll G01 movements\nG00 movements without movement in X/Y/Z direction\nEvery other movement type or without the required feature flag will just\nbe forwarded to the out-queue, except for one case:\nThe first element after a merging block is going to be converted into a line,\nexcept for administrative (i.e. M-function, G4 etc.) and G00 elements.\nNote\nThe function block\ndoes only merge the additional axes A/B/C (P/Q/U/V/W are not considered)\ndoes not support h-functions\ndoes not support changes of flags like G51, G52, G40 and so on. These changes are\nignored.\ntakes at most 128 line segments into account (as this quantity influences both\nperformance and storage size).\ndoes not support probe movements / G31.\nA spline always contains the same tool correction information\n(i.e. lengths and diameter) as the first of the segments\nthat it replaces.\nInOut:\nScope\nName\nType\nInitial\nComment\nInput\nbExecute\nBOOL\nStarts on rising edge; while\nTRUE\n, the function block is\nactive.\npoqDataIn\nPOINTER TO\nSMC_OUTQUEUE\nPoints to the\nSMC_OUTQUEUE\n-structure object, which contains the\nSMC_GEOINFO\nobjects of the unsmoothed path; typically it points to the output\npoqDataOut\nof the preceding module (e.g. the\nSMC_NCDecoder\n).\nnSizeOutQueue\nUDINT\nSize of the data buffer\npbyBufferOutQueue``\nin bytes\npbyBufferOutQueue\nPOINTER TO ARRAY [0..0]\nOF SMC_GEOINFO\nPoints to the first byte of the memory area being allocated for the\nSMC_OUTQUEUE\n-structure. This area must be at least as big as defined in\nnSizeOutQueue\n. Typically the allocation of the memory buffer is done within\nthe declaration part of the IEC-program by defining an array of\nSMC_GeoInfo\n(ExampleBuf:\nARRAY[1..50]\nOF\nSMC_GEOINFO\nfor a buffer which can hold 50 path\nelements). After predefining the value it may be modified during a reset only.\npiMaxDifference\nSMC_POSINFO\nThe maximum allowed deviation from the original path, in X,\nY, Z, A, B and C\nusiMaxDegree\nUSINT\n5\nThe maximal degree for the resulting polynomials, at most 5\nwFeatureFlag\nWORD\nThe feature bit (0..31) used for smoothing (controlled by\nG38/G39)\nwAdditionalParamNumber\nWORD\nThe number of the additional parameter (set by G38 I/J/K) that is used as\na factor multiplied to the precision\ndMinimumCurvatureRadius\nLREAL\nIf a possibly generated spline contains a position where its curvature radius\nis less than this value, it wonât be generated.\nOutput\nbDone\nBOOL\nWill be set to\nTRUE\nas soon as the input data from\npoqDataIn\nhas been\nprocessed completely. Thereafter, the module will not perform any further actions\nuntil it gets reset. If the\nbExecute\ninput is\nFALSE\n,\nbDone\nwill be\nreset to\nFALSE\n.\nbBusy\nBOOL\nTRUE\n, while execution of function block is not finished\nbError\nBOOL\nSignals, that an error has occurred within the function\nblock\nwErrorID\nSMC_ERROR\nError identification\npoqDataOut\nPOINTER TO\nSMC_OUTQUEUE\nThe queue for the output path\nuiNrElems\nUINT\nThe number of elements that have been merged in this cycle",
  "tables": [
    {
      "headers": [
        "Scope",
        "Name",
        "Type",
        "Initial",
        "Comment"
      ],
      "rows": [
        {
          "Scope": "Input",
          "Name": "bExecute",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "Starts on rising edge; whileTRUE, the function block is\nactive."
        },
        [
          "poqDataIn",
          "POINTER TOSMC_OUTQUEUE",
          "",
          "Points to theSMC_OUTQUEUE-structure object, which contains theSMC_GEOINFOobjects of the unsmoothed path; typically it points to the outputpoqDataOutof the preceding module (e.g. theSMC_NCDecoder)."
        ],
        [
          "nSizeOutQueue",
          "UDINT",
          "",
          "Size of the data bufferpbyBufferOutQueue``in bytes"
        ],
        [
          "pbyBufferOutQueue",
          "POINTER TO ARRAY [0..0]\nOF SMC_GEOINFO",
          "",
          "Points to the first byte of the memory area being allocated for theSMC_OUTQUEUE-structure. This area must be at least as big as defined innSizeOutQueue. Typically the allocation of the memory buffer is done within\nthe declaration part of the IEC-program by defining an array ofSMC_GeoInfo(ExampleBuf:ARRAY[1..50]OFSMC_GEOINFOfor a buffer which can hold 50 path\nelements). After predefining the value it may be modified during a reset only."
        ],
        [
          "piMaxDifference",
          "SMC_POSINFO",
          "",
          "The maximum allowed deviation from the original path, in X,\nY, Z, A, B and C"
        ],
        [
          "usiMaxDegree",
          "USINT",
          "5",
          "The maximal degree for the resulting polynomials, at most 5"
        ],
        [
          "wFeatureFlag",
          "WORD",
          "",
          "The feature bit (0..31) used for smoothing (controlled by\nG38/G39)"
        ],
        [
          "wAdditionalParamNumber",
          "WORD",
          "",
          "The number of the additional parameter (set by G38 I/J/K) that is used as\na factor multiplied to the precision"
        ],
        [
          "dMinimumCurvatureRadius",
          "LREAL",
          "",
          "If a possibly generated spline contains a position where its curvature radius\nis less than this value, it wonât be generated."
        ],
        {
          "Scope": "Output",
          "Name": "bDone",
          "Type": "BOOL",
          "Initial": "",
          "Comment": "Will be set toTRUEas soon as the input data frompoqDataInhas been\nprocessed completely. Thereafter, the module will not perform any further actions\nuntil it gets reset. If thebExecuteinput isFALSE,bDonewill be\nreset toFALSE."
        },
        [
          "bBusy",
          "BOOL",
          "",
          "TRUE, while execution of function block is not finished"
        ],
        [
          "bError",
          "BOOL",
          "",
          "Signals, that an error has occurred within the function\nblock"
        ],
        [
          "wErrorID",
          "SMC_ERROR",
          "",
          "Error identification"
        ],
        [
          "poqDataOut",
          "POINTER TOSMC_OUTQUEUE",
          "",
          "The queue for the output path"
        ],
        [
          "uiNrElems",
          "UINT",
          "",
          "The number of elements that have been merged in this cycle"
        ]
      ]
    }
  ]
}