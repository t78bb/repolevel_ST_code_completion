{
  "library": "SM3_CNC",
  "title": "SMC_ToolRadiusCorr (FunctionBlock)",
  "url": "https://content.helpme-codesys.com/en/libs/SM3_CNC/Current/SM_CNC_POUs/SoftMotion-CNC/SoftMotion-Function-Blocks/SMC_ToolRadiusCorr.html",
  "page_title": "SMC_ToolRadiusCorr (FB)",
  "text": "GlobalTextList (GlobalTextList)\nImagePool_cnc_sm3 (ImagePool)\nImages\nLibrary Information\nGetLibVersion (Function)\nGetLibVersionNumber (Function)\nIsLibReleased (Function)\nProjektinformationen\nGetBooleanProperty (Function)\nGetCompany (Function)\nGetNumberProperty (Function)\nGetTextProperty (Function)\nGetTextProperty2 (Function)\nGetTitle (Function)\nGetVersion (Function)\nGetVersionProperty (Function)\nSM3_CNC_GetVersion (Function)\nSMC_CNC_LibParams (ParamList)\nSM_CNC_Data types\nFile\nSMC_SINGLEVAR (Struct)\nSMC_TOKENTYPE (Enum)\nSMC_VARLIST (Struct)\nSMC_VARTYPE (Enum)\nSoftMotion CNC\nSMC_ABC_SLOPES_AT_STOP (Enum)\nSMC_ABC_SLOPES_NO_STOP (Enum)\nSMC_ADDAXIS (Enum)\nSMC_AL_STATUS (Enum)\nSMC_CNC_REF (FunctionBlock)\nSMC_DEC_STATUS (Enum)\nSMC_DIRECTION (Enum)\nSMC_GAddress (Alias)\nSMC_GCODEVIEWER_DATA (Struct)\nSMC_GCODE_TEXT (Struct)\nSMC_GCODE_WORD (Struct)\nSMC_GCodeObjectId (Struct)\nSMC_GEOINFO (Struct)\nSMC_GWord (Struct)\nSMC_INT_STATUS (Enum)\nSMC_INT_VELMODE (Enum)\nSMC_LINE_3D (Struct)\nSMC_MOVTYP (Enum)\nSMC_M_PARAMETERS (Struct)\nSMC_OBJECTSPLITTERMODE (Enum)\nSMC_ORI_CONVENTION (Enum)\nSMC_OUTQUEUE (FunctionBlock)\nbFull (Property)\nSMC_PLANE_H (Struct)\nSMC_POSINFO (Struct)\nSMC_SEGMENT (Struct)\nSMC_SEGMENTTYPE (Enum)\nSMC_SMOOTHBSPLINE_MODE (Enum)\nSMC_SMOOTHPATHADDAXMODE (Enum)\nSMC_SMOOTHPATHMODE (Enum)\nSMC_Seg (Struct)\nSMC_TC_STATUS (Enum)\nSMC_TOOLCORRMODE (Enum)\nSMC_VECTOR6D (Struct)\nSM_CNC_POUs\nFile\nReadNCFile\nSMC_ReadNCFile (FunctionBlock)\nStream\nToken\nSMC_ReadNCQueue (FunctionBlock)\nCloseFile (Action)\nhelp functions\nSMC_StringBuffer (FunctionBlock)\nNC2\nGSentence\nSMC_GExpToken_Iterator (FunctionBlock)\nSMC_GJUMP_COMMAND (Enum)\nSMC_GJUMP_TARGET (Union)\nSMC_GSentence (Struct)\nSMC_GSentenceQueue (FunctionBlock)\nSMC_GSentence_DynCall (Struct)\nSMC_GSentence_GWords (Struct)\nSMC_GSentence_GWords_Create (Function)\nSMC_GSentence_Iterator (FunctionBlock)\nSMC_GSentence_Let (Struct)\nSMC_GSentence_SubCall (Struct)\nSMC_GSentence_SubRet (Struct)\nSMC_GSentence_Type (Enum)\nSMC_GSentence_Union (Union)\nSMC_GVarDecl (Struct)\nSMC_GVar_Type (Enum)\nSMC_GWord_Iterator (FunctionBlock)\nSMC_NC_CopySentence (Function)\nSMC_NC_CopySentenceChecked (Function)\nGSentenceJumpBuffer\nSMC_GSentenceJumpBuffer (FunctionBlock)\nInterpreter\nCallstack\nSMC_NCInterpreter (FunctionBlock)\nParser\nExpressions\nSMC_NCTokenParser (FunctionBlock)\nSMC_NC_SourcePosition (Struct)\nSymbolTable\nReadNCFile2\nSMC_IGSentenceModifier (Interface)\nSMC_INCLookup (Interface)\nSMC_ITokenModifier (Interface)\nSMC_NCLookupFile (FunctionBlock)\nSMC_NCNavigator (FunctionBlock)\nSMC_NC_CanProcessTokens (Function)\nSMC_NC_FindProgramFile (Function)\nSMC_NC_PrependDefaults (FunctionBlock)\nSMC_NC_TokenQueue_Completed (Function)\nSMC_ReadNCFile2 (FunctionBlock)\nSMC_ReadNCFromStream (FunctionBlock)\nSoftMotion CNC\nCoordinate Transformations\nSMC_CoordinateTransformation3D (FunctionBlock)\nSMC_DetermineCuboidBearing (FunctionBlock)\nSMC_InvCoordinateTransformation3D (FunctionBlock)\nSMC_TeachCoordinateSystem (FunctionBlock)\nSMC_UnitVectorToRPY (FunctionBlock)\nDirect Axis Control\nSMC_ControlAxisByPos (FunctionBlock)\nSMC_ControlAxisByPosVel (FunctionBlock)\nSMC_ControlAxisByVel (FunctionBlock)\nGCode Viewer\nSMC_GCodeViewer (FunctionBlock)\nGeoInfo Help Functions\nSMC_AdaptHelpMarks (Function)\nSMC_CalcEndPnt (Function)\nSMC_CalcLengthGeo (Function)\nSMC_CalcStartPnt (Function)\nSMC_CutEnd (Function)\nSMC_CutStart (Function)\nSMC_GeoinfoInit (Function)\nSMC_GetAccVec (Function)\nSMC_GetAddAxValue (Function)\nSMC_GetClosestPnt (Function)\nSMC_GetLengthOfPrefix (Function)\nSMC_GetPnt (Function)\nSMC_GetPntPI (Function)\nSMC_GetTanVec (Function)\nSMC_GetTanVec3D (Function)\nSMC_InvertDirection (Function)\nSMC_RampInCorr (Function)\nSMC_RampOutCorr (Function)\nSMC_RecalculateHelpMarks (Function)\nSMC_SingleCorr (Function)\nOutQueue Functions\nSMC_AppendObj (Function)\nSMC_DeleteObj (Function)\nSMC_GetCount (Function)\nSMC_GetHistoryCount (Function)\nSMC_GetLastObj (Function)\nSMC_GetObj (Function)\nSMC_GetObjFromEnd (Function)\nSMC_GetObjFromHistory (Function)\nSMC_OutQueueInit (Function)\nSMC_OutQueueIsSyncing (Function)\nSMC_OutQueue_IsFull (Function)\nSMC_RestoreQueue (Function)\nSMC_SetObj (Function)\nSMC_SetQueueCapacity (Function)\nPosinfo Functions\nSMC_PosInfo_Trf_Inverse (Function)\nSMC_PosInfo_Trf_Mult (Function)\nQueue manipulation\nSMC_QueueSetReservedEntries (FunctionBlock)\nSMC_RotateQueue2D (FunctionBlock)\nSMC_ScaleQueue3D (FunctionBlock)\nSMC_TranslateQueue3D (FunctionBlock)\nSoftMotion Function Blocks\nBlockSearch\nDecoderBuffer\nInterpolator_Help_Functions\nM_Functions\nNCDecoder_Help_Functions\nSMC_AddGCodeState (Struct)\nSMC_AvoidLoop (FunctionBlock)\nSMC_CheckForLimits (FunctionBlock)\nSMC_CheckVelocities (FunctionBlock)\nSMC_ExtendedVelocityChecks (FunctionBlock)\nSMC_Interpolator (FunctionBlock)\nSMC_Interpolator2Dir (FunctionBlock)\nSMC_Interpolator2Dir_SlowTask (FunctionBlock)\nSMC_LimitCircularVelocity (FunctionBlock)\nSMC_LimitDynamics (FunctionBlock)\nSMC_NCDecoder (FunctionBlock)\nSMC_ObjectSplitter (FunctionBlock)\nSMC_ReadAdditionalIpoState (FunctionBlock)\nSMC_RecomputeABCSlopes (FunctionBlock)\nSMC_ReduceVelEndAtCorner (FunctionBlock)\nSMC_RoundPath (FunctionBlock)\nSMC_SegmentAnalyzer (FunctionBlock)\nSMC_SetInterpreterStartPosition (FunctionBlock)\nSMC_SmoothAddAxes (FunctionBlock)\nSMC_SmoothBSpline (FunctionBlock)\nSMC_SmoothMerge (FunctionBlock)\nSMC_SmoothPath (FunctionBlock)\nSMC_ToolCorr (FunctionBlock)\nSMC_ToolLengthCorr (FunctionBlock)\nSMC_ToolRadiusCorr (FunctionBlock)\nSMC_XInterpolator (FunctionBlock)\nSM_Trafo_Data types\nSMC_ArticulatedRobot_6DOF_J0_State (Enum)\nSMC_ArticulatedRobot_6DOF_J1_State (Enum)\nSMC_ArticulatedRobot_6DOF_J4_State (Enum)\nSMC_TrafoConfig_4AxisPalletizer (Struct)\nSMC_TrafoConfig_ArticulatedRobot_6DOF (Struct)\nSMC_TrafoResult_4AxisPalletizer (Enum)\nSMC_TrafoResult_ArticulatedRobot_6DOF (Enum)\nSMC_VECTORDIR (Enum)\nSM_Trafo_POUs\nForward and inverse transformation\nSMC_TRAFOV_\nSoftMotion Transformations\nGantry systems\nParallel Systems\nRobot Kinematiks\nScara System\nWrapper\nadditional FBs\nVisu_Templates\nFile\nCNC\nSM_CNC_Visualizations\nFBs\nCNC\nDirect Axis Control\nTranslation & Rotation & Scaling\nhelp visu\nSM_Trafo_Visualizations\nTrafo templates\nGantry\nParallel\nRobot\nScara\nVisu_Templates_New\nFramed Visu Helpers\nTextListForCombobox_MC_DIRECTION (TextList)\nTextListForCombobox_SMC_ABC_SLOPES_AT_STOP (TextList)\nTextListForCombobox_SMC_ABC_SLOPES_NO_STOP (TextList)\nTextListForCombobox_SMC_AL_STATUS (TextList)\nTextListForCombobox_SMC_DEC_STATUS (TextList)\nTextListForCombobox_SMC_DIRECTION (TextList)\nTextListForCombobox_SMC_ERROR (TextList)\nTextListForCombobox_SMC_INT_STATUS (TextList)\nTextListForCombobox_SMC_INT_VELMODE (TextList)\nTextListForCombobox_SMC_ORI_CONVENTION (TextList)\nTextListForCombobox_SMC_SMOOTHBSPLINE_MODE (TextList)\nTextListForCombobox_SMC_SMOOTHPATHADDAXMODE (TextList)\nTextListForCombobox_SMC_SMOOTHPATHMODE (TextList)\nTextListForCombobox_SMC_TC_STATUS (TextList)\nTextListForCombobox_SMC_TOOLCORRMODE (TextList)\nFile and Project Information\nLibrary Reference\n3SLicense\nLibrary Identification\nLibrary Properties\nBase Interfaces\nLibrary Identification\nLibrary Properties\nCmpLog\nLibrary Identification\nLibrary Properties\nFloatingPointUtils\nLibrary Identification\nLibrary Properties\nMatrix\nLibrary Identification\nLibrary Properties\nSM3_Basic\nLibrary Identification\nLibrary Properties\nLibrary Parameter\nSM3_RBase\nLibrary Identification\nLibrary Properties\nSM3_Shared\nLibrary Identification\nLibrary Properties\nSM3_Transformation\nLibrary Identification\nLibrary Properties\nStandard\nLibrary Identification\nLibrary Properties\nSysFile\nLibrary Identification\nLibrary Properties\nSysMem\nLibrary Identification\nLibrary Properties\nSysTarget\nLibrary Identification\nLibrary Properties\nSysTypes2 Interfaces\nLibrary Identification\nLibrary Properties\nVisuElem3DPath\nLibrary Identification\nLibrary Properties\nLibrary Parameter\nVisuElemCamDisplayer\nLibrary Identification\nLibrary Properties\nLibrary Parameter\nVisuElemMeter\nLibrary Identification\nLibrary Properties\nVisuElemTextEditor\nLibrary Identification\nLibrary Properties\nVisuElemTrace\nLibrary Identification\nLibrary Properties\nVisuElems\nLibrary Identification\nLibrary Properties\nVisuElemsAlarm\nLibrary Identification\nLibrary Properties\nVisuElemsDateTime\nLibrary Identification\nLibrary Properties\nVisuElemsSpecialControls\nLibrary Identification\nLibrary Properties\nVisuElemsWinControls\nLibrary Identification\nLibrary Properties\nVisuInputs\nLibrary Identification\nLibrary Properties\nVisuNativeControl\nLibrary Identification\nLibrary Properties\nSM3_CNC\nDocs\n»\nSM_CNC_POUs\n»\nSoftMotion\nCNC\n»\nSoftMotion\nFunction\nBlocks\n»\nSMC_ToolRadiusCorr (FB)\nSMC_ToolRadiusCorr (FB)\nÂ¶\nFUNCTION_BLOCK SMC_ToolRadiusCorr\nSMC_ToolRadiusCorr\ncreates a shifted path to compensate for the\nradius of a tool.\nIn the shifted path, each point has a defined distance to\nthe original point (tool radius correction).\nA typical application is the milling of a programmed contour with a\nmilling drill of a certain diameter. In order to compensate the radius\nof the drill, the milling drill must follow a shifted path.\nThis function block replaces\nSMC_ToolCorr\n.\nThe main feature is to also support 3d-movements\nand to respect the current correction plane\n(i.e. at decoding time the plane that circles would be defined in).\nWe always use\nSMC_TOOLCORRMODE.TC_RAMP_IN\n,\nso the input\neMode\nis no longer necessary.\nTool radius correction is controlled by the g-code:\nG41\n(\nG42\n) starts correction to the left (right),\nG40\nends it.\nExample 1: Simple tool radius correction\nG-Code\nN0 G41 D3 (start correction)\nN1 G0 X3 Y10 F100 E1000 E-1000\nN2 G1 X7 Y10\nN3 G1 X10 Y0\nN4 G40 (end correction)\nN5 G1 X20\nIn the above example, the element in sentence N1 is used for ramping in,\nthe one in sentence N5 for ramping out.\nExample 2: Tool radius correction in different planes\nG-Code\nN0 G41 D1 F100   (start correction)\nN1 G16 I1 J1 K1  (set correction plane)\nN2 G1 X5\nN3 G2 X0 Y5 R5\nN4 G40           (turn off correction)\nN5 G1 X0 Y7.5\nN6 G42 D1        (start correction)\nN7 G16 I1 J1 K-1 (with different correction plane)\nN8 G1 Y10\nN9 G3 X10 Y0 R15\nThis example shows how tool radius correction can work\nin different planes. The correction plane is changed with\nG16\n.\nThe elements in sentence N5 and N8 are used for ramping out and\nramping in again.\nNote\nAt inside corners, the projections of the corrected (shifted)\nelements onto the correction plane will usually intersect\nand we shorten those elements accordingly.\nConcerning the component which is perpendicular to the\ncorrection plane (z when correcting in the xy plane),\nthe new meeting point will equal component of the original\ncorner.  The value of the additional axes at the point of\nintersection will also equal the value of the additional axes\nat the original corner.\nG75 during tool radius correction is not supported:\nThe correction of one element strongly depends on the following,\nwhich canât be known if there is a G75 in between.\nA G75 must not follow a G40, either: The first movement after G40\nis used for ramping out and therefore still âbelongsâ to the\ncorrection block.\nFor the same reason, we get in trouble if the in-queue is full\nwithout containing a second cartesian element\n(e.g. only M-functions), and also return an error.\nIf the correction radius or the correction plane\nor the correction side (left or right) changes from one element\nto the other, we will act like at the beginning of tool correction\nand use the element with the new parameters for ramping in.\nChanging the planes during tool correction\nis not supported.\nJumps (G92 or implicitly by G43) during tool correction\nare not supported.\nSplines with degree 5, as created by\nSMC_SmoothPath\nor\nSMC_SmoothMerge\n, are not supported yet.\nG0 elements can be used during tool radius correction.\nThey will be shifted and cut like G1 elements.\nEllipses (G08/G09) are not supported. An error will be\nreported when an ellipse element is detected during\nactive tool radius correction.\nPROBE movements such as G31 are not supported. The error\nSMC_PROBE_G31_NOT_ALLOWED\nis reported if a PROBE movement\nis encountered while tool radius correction is active.\nInOut:\nScope\nName\nType\nComment\nInput\nbExecute\nBOOL\nStarts on rising edge\nbAbort\nBOOL\nIf\nTRUE\n, the current processing of this function block\nis aborted\nbAppend\nBOOL\nAs long as this input remains\nFALSE\n, the DataOutQueue will be\ncleared at each reset.\nAs long as it remains\nTRUE\n, newly incoming data will be written\nto the end of the DataOutQueue.\npoqDataIn\nPOINTER TO\nSMC_OUTQUEUE\nInput path queue\nnSizeOutQueue\nUDINT\nThe size of pbyBufferOutQueue in bytes\npbyBufferOutQueue\nPOINTER TO ARRAY [0..0]\nOF SMC_GEOINFO\nThe buffer for the output queue\ndAdditionalToolRadius\nLREAL\nThis variable defines an additional tool radius. Whenever a new tool\nradius correction starts, it is added to the tool radius defined in the\nSMC_GEOINFO\nstructure. The path will then be shifted by the new tool\nradius. If this variable is modified during an active tool radius\ncorrection, it will have no effect until the active tool radius correction\nends and a new tool radius correction is started (with\nG41\nor\nG42\n).\nNote: The additional tool radius may also be negative. If the sum of the\nadditional tool radius and the radius defined in the\nSMC_GEOINFO\nstructure\nis negative, the correction side is inverted (left <-> right).\nOutput\nbDone\nBOOL\nIndicates the entire input path has been processed\nbBusy\nBOOL\nIndicates the function block is still busy processing\nbError\nBOOL\nAn error has occurred\nwErrorID\nSMC_ERROR\nError-ID\npoqDataOut\nPOINTER TO\nSMC_OUTQUEUE\nOutput path queue",
  "tables": [
    {
      "headers": [
        "Scope",
        "Name",
        "Type",
        "Comment"
      ],
      "rows": [
        {
          "Scope": "Input",
          "Name": "bExecute",
          "Type": "BOOL",
          "Comment": "Starts on rising edge"
        },
        [
          "bAbort",
          "BOOL",
          "IfTRUE, the current processing of this function block\nis aborted"
        ],
        [
          "bAppend",
          "BOOL",
          "As long as this input remainsFALSE, the DataOutQueue will be\ncleared at each reset.\nAs long as it remainsTRUE, newly incoming data will be written\nto the end of the DataOutQueue."
        ],
        [
          "poqDataIn",
          "POINTER TOSMC_OUTQUEUE",
          "Input path queue"
        ],
        [
          "nSizeOutQueue",
          "UDINT",
          "The size of pbyBufferOutQueue in bytes"
        ],
        [
          "pbyBufferOutQueue",
          "POINTER TO ARRAY [0..0]\nOF SMC_GEOINFO",
          "The buffer for the output queue"
        ],
        [
          "dAdditionalToolRadius",
          "LREAL",
          "This variable defines an additional tool radius. Whenever a new tool\nradius correction starts, it is added to the tool radius defined in theSMC_GEOINFOstructure. The path will then be shifted by the new tool\nradius. If this variable is modified during an active tool radius\ncorrection, it will have no effect until the active tool radius correction\nends and a new tool radius correction is started (withG41orG42).\nNote: The additional tool radius may also be negative. If the sum of the\nadditional tool radius and the radius defined in theSMC_GEOINFOstructure\nis negative, the correction side is inverted (left <-> right)."
        ],
        {
          "Scope": "Output",
          "Name": "bDone",
          "Type": "BOOL",
          "Comment": "Indicates the entire input path has been processed"
        },
        [
          "bBusy",
          "BOOL",
          "Indicates the function block is still busy processing"
        ],
        [
          "bError",
          "BOOL",
          "An error has occurred"
        ],
        [
          "wErrorID",
          "SMC_ERROR",
          "Error-ID"
        ],
        [
          "poqDataOut",
          "POINTER TOSMC_OUTQUEUE",
          "Output path queue"
        ]
      ]
    }
  ]
}