[["``` \nVAR\n\tfbDoorTimer\t\t\t:\tTON;\t\t// \u95e8\u64cd\u4f5c\u5b9a\u65f6\u5668\n\tbDoorOpening\t\t:\tBOOL;\t\t// \u95e8\u6b63\u5728\u6253\u5f00\n\tbDoorClosing\t\t:\tBOOL;\t\t// \u95e8\u6b63\u5728\u5173\u95ed\nEND_VAR\n\n// \u95e8\u63a7\u5236\u903b\u8f91\nIF bArrivedAtTarget THEN\n\t// \u5982\u679c\u5230\u8fbe\u76ee\u6807\u697c\u5c42\u4e14\u95e8\u672a\u6253\u5f00\uff0c\u5219\u53d1\u51fa\u5f00\u95e8\u547d\u4ee4\n\tIF NOT bDoorOpen THEN\n\t\tbOpenDoor := TRUE;\n\t\tbCloseDoor := FALSE;\n\t\tbDoorOpening := TRUE;\n\t\tfbDoorTimer(IN:=TRUE, PT:=T#5S); // \u5f00\u95e8\u5ef6\u65f65\u79d2\n\t\tIF fbDoorTimer.Q THEN\n\t\t\tbDoorOpen := TRUE;\n\t\t\tbDoorOpening := FALSE;\n\t\t\tbDoorReady := FALSE;\n\t\tEND_IF\n\tEND_IF\nELSE\n\t// \u5982\u679c\u672a\u5230\u8fbe\u76ee\u6807\u697c\u5c42\u4e14\u95e8\u5df2\u6253\u5f00\uff0c\u5219\u53d1\u51fa\u5173\u95e8\u547d\u4ee4\n\tIF bDoorOpen THEN\n\t\tbCloseDoor := TRUE;\n\t\tbOpenDoor := FALSE;\n\t\tbDoorClosing := TRUE;\n\t\tfbDoorTimer(IN:=TRUE, PT:=T#5S); // \u5173\u95e8\u5ef6\u65f65\u79d2\n\t\tIF fbDoorTimer.Q THEN\n\t\t\tbDoorOpen := FALSE;\n\t\t\tbDoorClosing := FALSE;\n\t\t\tbDoorReady := TRUE;\n\t\tEND_IF\n\tEND_IF\nEND_IF\n\n// \u5982\u679c\u95e8\u5df2\u5173\u95ed\u4f20\u611f\u5668\u89e6\u53d1\uff0c\u66f4\u65b0\u95e8\u72b6\u6001\nIF bDoorClosed THEN\n\tbDoorOpen := FALSE;\n\tbDoorReady := TRUE;\n\tbCloseDoor := FALSE;\n\tbDoorClosing := FALSE;\nEND_IF\n```"], ["``` \nVAR\n\tnCurrentTarget\t\t:\tINT;\t\t\t\t// \u5f53\u524d\u76ee\u6807\u697c\u5c42\n\tnState\t\t\t\t:\tINT;\t\t\t\t// \u72b6\u6001\u673a\nEND_VAR\n\nCASE nState OF\n\t0: // \u7a7a\u95f2\u72b6\u6001\n\t\tbMovingUp := FALSE;\n\t\tbMovingDown := FALSE;\n\t\tbArrivedAtTarget := FALSE;\n\t\t\n\t\t// \u67e5\u627e\u4e0b\u4e00\u4e2a\u76ee\u6807\u697c\u5c42\n\t\tFOR i := 0 TO 3 DO\n\t\t\tIF TargetFloors[i] THEN\n\t\t\t\tnCurrentTarget := i;\n\t\t\t\tnState := 1; // \u5f00\u59cb\u79fb\u52a8\n\t\t\t\tEXIT;\n\t\t\tEND_IF\n\t\tEND_FOR\n\t\t\n\t1: // \u79fb\u52a8\u5230\u76ee\u6807\u697c\u5c42\n\t\tIF CurrentFloor < nCurrentTarget THEN\n\t\t\tbMovingUp := TRUE;\n\t\t\tbMovingDown := FALSE;\n\t\tELSIF CurrentFloor > nCurrentTarget THEN\n\t\t\tbMovingUp := FALSE;\n\t\t\tbMovingDown := TRUE;\n\t\tELSE\n\t\t\tbMovingUp := FALSE;\n\t\t\tbMovingDown := FALSE;\n\t\t\tbArrivedAtTarget := TRUE;\n\t\t\tTargetFloors[nCurrentTarget] := FALSE; // \u6e05\u9664\u76ee\u6807\u697c\u5c42\n\t\t\tnState := 0; // \u8fd4\u56de\u7a7a\u95f2\u72b6\u6001\n\t\tEND_IF\n\t\t\n\t\t// \u68c0\u67e5\u95e8\u662f\u5426\u51c6\u5907\u597d\n\t\tIF bDoorReady THEN\n\t\t\tIF bMovingUp THEN\n\t\t\t\tCurrentFloor := CurrentFloor + 1;\n\t\t\tELSIF bMovingDown THEN\n\t\t\t\tCurrentFloor := CurrentFloor - 1;\n\t\t\tEND_IF\n\t\tEND_IF\nEND_CASE\n```"], ["```pascal\nVAR\n\tDetectedFloor\t:\tINT := -1;\t// \u68c0\u6d4b\u5230\u7684\u697c\u5c42\uff0c\u521d\u59cb\u503c\u4e3a-1\u8868\u793a\u672a\u68c0\u6d4b\u5230\nEND_VAR\n\n// \u68c0\u6d4b\u5f53\u524d\u697c\u5c42\nIF FloorSensor0 THEN\n\tDetectedFloor := 0;\nELSIF FloorSensor1 THEN\n\tDetectedFloor := 1;\nELSIF FloorSensor2 THEN\n\tDetectedFloor := 2;\nELSIF FloorSensor3 THEN\n\tDetectedFloor := 3;\nEND_IF\n\n// \u8fd4\u56de\u68c0\u6d4b\u5230\u7684\u697c\u5c42\uff0c\u5982\u679c\u672a\u68c0\u6d4b\u5230\u5219\u8fd4\u56de\u5f53\u524d\u697c\u5c42\nIF DetectedFloor <> -1 THEN\n\tRETURN DetectedFloor;\nELSE\n\tRETURN CurrentFloor;\nEND_IF\n```\n\nThis function `F_DetectCurrentFloor` checks which floor sensor is active and returns the corresponding floor number. If no sensor is active, it returns the current floor as a fallback."], ["```\nVAR\n\ti\t\t\t\t:\tINT;\t\t// \u5faa\u73af\u53d8\u91cf\nEND_VAR\n\n// \u6839\u636e\u547c\u53eb\u6309\u94ae\u8bbe\u7f6e\u76ee\u6807\u697c\u5c42\nIF CallGround THEN\n\tTargetFloors[0] := TRUE;\nEND_IF;\n\nIF CallFloor1 THEN\n\tTargetFloors[1] := TRUE;\nEND_IF;\n\nIF CallFloor2 THEN\n\tTargetFloors[2] := TRUE;\nEND_IF;\n\nIF CallFloor3 THEN\n\tTargetFloors[3] := TRUE;\nEND_IF;\n\n// \u786e\u4fdd\u76ee\u6807\u697c\u5c42\u6570\u7ec4\u7684\u6709\u6548\u6027\nFOR i := 0 TO 3 DO\n\tIF TargetFloors[i] THEN\n\t\tEXIT; // \u5982\u679c\u6709\u76ee\u6807\u697c\u5c42\uff0c\u9000\u51fa\u5faa\u73af\n\tEND_IF;\nEND_FOR;\n```"], ["```pascal\nVAR_OUTPUT\n\tnUpdatedAni\t\t:\tDINT;\t\t// \u66f4\u65b0\u540e\u7684\u52a8\u753b\u503c\nEND_VAR\nVAR\n\tbDoorMoving\t\t:\tBOOL;\t\t// \u95e8\u6b63\u5728\u79fb\u52a8\nEND_VAR\n\n// \u521d\u59cb\u5316\u8f93\u51fa\u503c\nnUpdatedAni := nCurrentAni;\n\n// \u68c0\u67e5\u662f\u5426\u9700\u8981\u5f00\u95e8\nIF bOpenDoor AND NOT bDoorMoving THEN\n\tbDoorMoving := TRUE;\n\tIF nCurrentAni < nMaxAni THEN\n\t\tnUpdatedAni := nCurrentAni + 1; // \u589e\u52a0\u52a8\u753b\u503c\n\tELSE\n\t\tbDoorMoving := FALSE; // \u52a8\u753b\u8fbe\u5230\u6700\u5927\u503c\uff0c\u505c\u6b62\u79fb\u52a8\n\tEND_IF\nEND_IF\n\n// \u68c0\u67e5\u662f\u5426\u9700\u8981\u5173\u95e8\nIF bCloseDoor AND NOT bDoorMoving THEN\n\tbDoorMoving := TRUE;\n\tIF nCurrentAni > 0 THEN\n\t\tnUpdatedAni := nCurrentAni - 1; // \u51cf\u5c11\u52a8\u753b\u503c\n\tELSE\n\t\tbDoorMoving := FALSE; // \u52a8\u753b\u8fbe\u5230\u6700\u5c0f\u503c\uff0c\u505c\u6b62\u79fb\u52a8\n\tEND_IF\nEND_IF\n\n// \u5982\u679c\u6709\u697c\u5c42\u547c\u53eb\u4e14\u95e8\u672a\u5b8c\u5168\u6253\u5f00\uff0c\u4fdd\u6301\u95e8\u6253\u5f00\nIF bCallFloor AND nCurrentAni < nMaxAni THEN\n\tnUpdatedAni := nMaxAni;\nEND_IF\n\n// \u8fd4\u56de\u66f4\u65b0\u540e\u7684\u52a8\u753b\u503c\nRETURN nUpdatedAni;\n```"]]