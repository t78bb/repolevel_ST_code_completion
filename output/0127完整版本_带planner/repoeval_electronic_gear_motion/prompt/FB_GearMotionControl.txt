This is the known requirement information for the function to be completed:
This code is intended to implement a dual-axis gear motion control system with start, stop, coupling, and decoupling functionalities, ensuring synchronized motion between a master and slave axis.
This provides you with a plan of implementation steps for the function to be completed. Subsequent ST code must strictly follow this plan and must not deviate from the core logic. The following is the plan of implementation steps:
功能规划:
1. 检查输入信号 bStart 和 bStop 的状态；优先处理停止信号 bStop，将运动设为停止并更新 bRunning、bReady 状态。
2. 若 bStop 为 FALSE 且 bStart 为 TRUE，则检查 nRatioNumerator、nRatioDenominator 的有效性（不得为零），以及运动方向 nDirection 是否为有效值（1或-1），否则设置 bError 为 TRUE。
3. 在接收有效的启动信号 bStart 且输入参数合法时，根据传动比 (nRatioNumerator/nRatioDenominator) 和运动方向 nDirection 计算目标从轴 SlaveAxis 的速度。
4. 对主轴 MasterAxis 和从轴 SlaveAxis 设置运动参数 rVelocity、rAcceleration 和 rDeceleration，确保运动同步。
5. 启动主轴和从轴的运动，更新 bRunning 为 TRUE，bReady 为 FALSE，并设置 nCurrentState 为运行状态值。
6. 在运行过程中监控运动状态，检测异常或完成条件；若检测到异常则设置 bError 为 TRUE 并停止运动，若完成则更新 bReady 为 TRUE 并停止主轴和从轴。
Continue writing the following code:

```
# Here are some relevant code fragments from other files of the repo:
# --------------------------------------------------
# the below code fragment can be found in:
# 电子齿轮运动实训-FUN\FB_GearMotionControl.st
# --------------------------------------------------
# FUNCTION_BLOCK FB_GearMotionControl
# VAR_INPUT
# 	MasterAxis			:	AXIS_REF;		//主轴引用
# 	SlaveAxis			:	AXIS_REF;		//从轴引用
# 	bStart				:	BOOL;			//启动信号
# 	bStop				:	BOOL;			//停止信号
# 	nRatioNumerator		:	INT := 1;		//传动比分子
# 	nRatioDenominator	:	INT := 1;		//传动比分母
# 	nDirection			:	INT := 1;		//运动方向（1=正向，-1=反向）
# 	rVelocity			:	REAL := 360.0;	//主轴速度
# 	rAcceleration		:	REAL := 10000.0;//加速度
# 	rDeceleration		:	REAL := 10000.0;//减速度
# END_VAR
# VAR_OUTPUT
# 	bRunning			:	BOOL;			//运行中
# 	bReady				:	BOOL;			//准备就绪（可以启动）
# 	bError				:	BOOL;			//错误标志
# 	nCurrentState		:	BYTE;			//当前状态
# END_VAR
# VAR
# 	fbPowerMgr			:	FB_DualAxisPower;	//双轴电源管理
# 	fbGearCtrl			:	FB_GearCoupling;	//齿轮耦合控制
# 	fbMoveVel			:	MC_MoveVelocity;	//速度运动
# 	fbHaltMaster		:	MC_Halt;			//主轴停止
# 	fbHaltSlave			:	MC_Halt;			//从轴停止
# 	fbStartRtrig		:	R_TRIG;				//启动上升沿
# 	fbStopRtrig			:	R_TRIG;				//停止上升沿
# 	nState				:	BYTE;				//内部状态机
# END_VAR
# 
# // 双轴电源管理
# fbPowerMgr(
# 	Axis1 := MasterAxis,
# 	Axis2 := SlaveAxis,
# 	bEnable := TRUE
# );
# 
# // 状态机
# CASE nState OF
# 	0: (* 等待轴准备就绪 *)
# 
# --------------------------------------------------
# the below code fragment can be found in:
# 电子齿轮运动实训-FUN\FB_GearMotionControl.st
# --------------------------------------------------
# FUNCTION_BLOCK FB_GearMotionControl
# VAR_INPUT
# 	MasterAxis			:	AXIS_REF;		//主轴引用
# 	SlaveAxis			:	AXIS_REF;		//从轴引用
# 	bStart				:	BOOL;			//启动信号
# 	bStop				:	BOOL;			//停止信号
# 	nRatioNumerator		:	INT := 1;		//传动比分子
# 	nRatioDenominator	:	INT := 1;		//传动比分母
# 	nDirection			:	INT := 1;		//运动方向（1=正向，-1=反向）
# 	rVelocity			:	REAL := 360.0;	//主轴速度
# 	rAcceleration		:	REAL := 10000.0;//加速度
# 	rDeceleration		:	REAL := 10000.0;//减速度
# END_VAR
# VAR_OUTPUT
# 	bRunning			:	BOOL;			//运行中
# 	bReady				:	BOOL;			//准备就绪（可以启动）
# 	bError				:	BOOL;			//错误标志
# 	nCurrentState		:	BYTE;			//当前状态
# END_VAR
# VAR
# 	fbPowerMgr			:	FB

FUNCTION_BLOCK FB_GearMotionControl
VAR_INPUT
	MasterAxis			:	AXIS_REF;		//主轴引用
	SlaveAxis			:	AXIS_REF;		//从轴引用
	bStart				:	BOOL;			//启动信号
	bStop				:	BOOL;			//停止信号
	nRatioNumerator		:	INT := 1;		//传动比分子
	nRatioDenominator	:	INT := 1;		//传动比分母
	nDirection			:	INT := 1;		//运动方向（1=正向，-1=反向）
	rVelocity			:	REAL := 360.0;	//主轴速度
	rAcceleration		:	REAL := 10000.0;//加速度
	rDeceleration		:	REAL := 10000.0;//减速度
END_VAR
VAR_OUTPUT
	bRunning			:	BOOL;			//运行中
	bReady				:	BOOL;			//准备就绪（可以启动）
	bError				:	BOOL;			//错误标志
	nCurrentState		:	BYTE;			//当前状态
END_VAR
```