{"requirement": "This code is intended to implement a heat exchanger process simulation with a dead time and steady-state adjustment based on input parameters and sampling intervals.", "provide_code": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR", "docs": [{"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\tA := EXP(-delta_t/Tp);\n\tB := 1 - A;\n\tC := 2;\n\t\n\t//PV := A * lastPV + B * Kp * CO + C;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\tA := EXP(-delta_t/Tp);\n\tB := 1 - A;\n\tC := 2;\n\t\n\t//PV := A * lastPV + B * Kp * CO + C;\n\tPV := 0.987 * lastPV - 0.00679 * CO + C;\n\tlastPV := PV;\n\n\tlastTime := now;\nEND_IF ", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n\t//Obs: At start, set lastTime to start temp Temp_In\n\tIF lastTime = T#0S THEN\n\t\tlastTemp := Temp_In;\n\tEND_IF\n\theat_flow := Heat_In - U * (lastTemp - Temp_Out);\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n\t//Obs: At start, set lastTime to start temp Temp_In\n\tIF lastTime = T#0S THEN\n\t\tlastTemp := Temp_In;\n\tEND_IF\n\theat_flow := Heat_In - U * (lastTemp - Temp_Out);\n\t\n\t//Second: calculate temperature change due to heat_flow\n\tTemp := lastTemp + heat_flow * delta_t / TC;\n\t\n\t//Update variables for next iteration\n\tlastTemp := Temp;\n\tlastTime := now;\nEND_IF;", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n\t//Obs: At start, set lastTime to start temp Temp_In\n\tIF lastTime = T#0S THEN\n\t\tlastTemp := Temp_In;\n\tEND_IF\n\theat_flow := Heat_In - U * (lastTemp - Temp_Out);\n\t\n\t//Second: calculate temperature change due to heat_flow\n\tTemp := lastTemp + heat_flow * delta_t / TC;\n\t\n\t//Update variables for next iteration\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}, {"text": "PROGRAM Test_PID_Heatx\nVAR\n\tPID_0: PID_controller;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 20;\n\tA_room_with_a_view: HeatExchanger;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,\n    PV := A_room_with_a_view.PV,\n    Kc := 5.0,\n    Ti := 10.0,\n    Td := 1.0,\n    SampleTime := T#2000ms,\n    LowerLimit := 0,\n    UpperLimit := 150,\n    CO => ,  // \u82e5\u4e0d\u9700\u8981\u5355\u72ec\u4f7f\u7528 CO \u7b49\u8f93\u51fa\uff0c\u53ef\u7559\u7a7a\uff0c\u6216\u6839\u636e\u9700\u6c42\u5b9a\u4e49\u53d8\u91cf\u63a5\u6536\n    CO_P => ,\n    CO_I => ,\n    CO_D => \n);\n", "title": "PID_controller-Progs\\Test_PID_Heatx.st"}, {"text": "END_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n\tELSIF CO > UpperLimit THEN\n\t\tCO := UpperLimit;\n\tEND_IF;\n\t\n\tlastTime := now;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n", "title": "PID_controller-Models\\Tank.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n    Heat_In := PID_controller_0.CO,\n    U := 100,   \n    TC := 2500,\n    Temp_In := 270,\n    Temp_Out := Temp_Out;\n    Sample_time := T#100ms,\n    Temp =>            \n);", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}, {"text": "//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n\t\tLevel := Lower_limit;\n\tELSIF Level > Upper_limit THEN\n\t\tLevel := Upper_limit;\n\tEND_IF;\n\tlastTime := now;\nEND_IF;", "title": "PID_controller-Models\\Tank.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n\t\tLevel := Lower_limit;\n\tELSIF Level > Upper_limit THEN\n\t\tLevel := Upper_limit;\n\tEND_IF;\n\tlastTime := now;\n", "title": "PID_controller-Models\\Tank.st"}], "task_id": "HeatExchanger"}
{"requirement": "This code is intended to implement a heat exchanger model that calculates room temperature over time based on input parameters such as heat source, thermal conductance, thermal capacity, and temperature differences.", "provide_code": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR", "docs": [{"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n\t//Obs: At start, set lastTime to start temp Temp_In\n\tIF lastTime = T#0S THEN\n\t\tlastTemp := Temp_In;\n\tEND_IF\n\theat_flow := Heat_In - U * (lastTemp - Temp_Out);\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n\t//Obs: At start, set lastTime to start temp Temp_In\n\tIF lastTime = T#0S THEN\n\t\tlastTemp := Temp_In;\n\tEND_IF\n\theat_flow := Heat_In - U * (lastTemp - Temp_Out);\n\t\n\t//Second: calculate temperature change due to heat_flow\n\tTemp := lastTemp + heat_flow * delta_t / TC;\n\t\n\t//Update variables for next iteration\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n\t//Obs: At start, set lastTime to start temp Temp_In\n\tIF lastTime = T#0S THEN\n\t\tlastTemp := Temp_In;\n\tEND_IF\n\theat_flow := Heat_In - U * (lastTemp - Temp_Out);\n\t\n\t//Second: calculate temperature change due to heat_flow\n\tTemp := lastTemp + heat_flow * delta_t / TC;\n\t\n\t//Update variables for next iteration\n\tlastTemp := Temp;\n\tlastTime := now;\nEND_IF;", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\tA := EXP(-delta_t/Tp);\n\tB := 1 - A;\n\tC := 2;\n\t\n\t//PV := A * lastPV + B * Kp * CO + C;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\tA := EXP(-delta_t/Tp);\n\tB := 1 - A;\n\tC := 2;\n\t\n\t//PV := A * lastPV + B * Kp * CO + C;\n\tPV := 0.987 * lastPV - 0.00679 * CO + C;\n\tlastPV := PV;\n\n\tlastTime := now;\nEND_IF ", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n    Heat_In := PID_controller_0.CO,\n    U := 100,   \n    TC := 2500,\n    Temp_In := 270,\n    Temp_Out := Temp_Out;\n    Sample_time := T#100ms,\n    Temp =>            \n);", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n    Heat_In := PID_controller_0.CO,\n    U := 100,   \n    TC := 2500,\n    Temp_In := 270,\n    Temp_Out := Temp_Out;\n", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}, {"text": "PROGRAM Test_PID_Heatx\nVAR\n\tPID_0: PID_controller;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 20;\n\tA_room_with_a_view: HeatExchanger;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,\n    PV := A_room_with_a_view.PV,\n    Kc := 5.0,\n    Ti := 10.0,\n    Td := 1.0,\n    SampleTime := T#2000ms,\n    LowerLimit := 0,\n    UpperLimit := 150,\n    CO => ,  // \u82e5\u4e0d\u9700\u8981\u5355\u72ec\u4f7f\u7528 CO \u7b49\u8f93\u51fa\uff0c\u53ef\u7559\u7a7a\uff0c\u6216\u6839\u636e\u9700\u6c42\u5b9a\u4e49\u53d8\u91cf\u63a5\u6536\n    CO_P => ,\n    CO_I => ,\n    CO_D => \n);\n", "title": "PID_controller-Progs\\Test_PID_Heatx.st"}, {"text": "PROGRAM Test_PID_Heatx\nVAR\n\tPID_0: PID_controller;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 20;\n\tA_room_with_a_view: HeatExchanger;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,\n    PV := A_room_with_a_view.PV,\n    Kc := 5.0,\n    Ti := 10.0,\n    Td := 1.0,\n    SampleTime := T#2000ms,\n    LowerLimit := 0,\n    UpperLimit := 150,\n    CO => ,  // \u82e5\u4e0d\u9700\u8981\u5355\u72ec\u4f7f\u7528 CO \u7b49\u8f93\u51fa\uff0c\u53ef\u7559\u7a7a\uff0c\u6216\u6839\u636e\u9700\u6c42\u5b9a\u4e49\u53d8\u91cf\u63a5\u6536\n    CO_P => ,\n    CO_I => ,\n    CO_D => \n);\n\n// \u8c03\u7528 HeatExchanger \u529f\u80fd\u5757\nA_room_with_a_view(\n    Kp := 2.0,\n    Tp := 20,\n", "title": "PID_controller-Progs\\Test_PID_Heatx.st"}, {"text": "END_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n\tELSIF CO > UpperLimit THEN\n\t\tCO := UpperLimit;\n\tEND_IF;\n\t\n\tlastTime := now;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n", "title": "PID_controller-Models\\Tank.st"}, {"text": "PROGRAM Test_PID_Heatx\nVAR\n\tPID_0: PID_controller;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 20;\n\tA_room_with_a_view: HeatExchanger;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,\n    PV := A_room_with_a_view.PV,\n    Kc := 5.0,\n    Ti := 10.0,\n    Td := 1.0,\n    SampleTime := T#2000ms,\n    LowerLimit := 0,\n    UpperLimit := 150,\n    CO => ,  // \u82e5\u4e0d\u9700\u8981\u5355\u72ec\u4f7f\u7528 CO \u7b49\u8f93\u51fa\uff0c\u53ef\u7559\u7a7a\uff0c\u6216\u6839\u636e\u9700\u6c42\u5b9a\u4e49\u53d8\u91cf\u63a5\u6536\n    CO_P => ,\n    CO_I => ,\n    CO_D => \n);\n\n// \u8c03\u7528 HeatExchanger \u529f\u80fd\u5757\nA_room_with_a_view(\n    Kp := 2.0,\n    Tp := 20,\n    CO := PID_0.CO,\n    Dead_t := 9.8,\n    C := 2.048,\n    Sample_time := T#100ms,\n    PV => \n);", "title": "PID_controller-Progs\\Test_PID_Heatx.st"}, {"text": "\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n\tELSIF CO > UpperLimit THEN\n\t\tCO := UpperLimit;\n\tEND_IF;\n\t\n\tlastTime := now;\n\tlastPV := PV;\nEND_IF;", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n\t\tLevel := Lower_limit;\n\tELSIF Level > Upper_limit THEN\n\t\tLevel := Upper_limit;\n\tEND_IF;\n\tlastTime := now;\nEND_IF;", "title": "PID_controller-Models\\Tank.st"}], "task_id": "HeatExchanger2"}
{"requirement": "This code is intended to implement a PID (Proportional-Integral-Derivative) controller for process control with configurable parameters, output limits, and anti-windup mechanisms.", "provide_code": "//***************************************************************\n//* A simple PID controller for Codesys.\n//* by Alexander Jaworowski\n//* Inspiration from https://github.com/br3ttb/Arduino-PID-Library\n//* https://github.com/alexjaw/PID_controller\n//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR", "docs": [{"text": "//***************************************************************\n//* A simple PID controller for Codesys.\n//* by Alexander Jaworowski\n//* Inspiration from https://github.com/br3ttb/Arduino-PID-Library\n//* https://github.com/alexjaw/PID_controller\n//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//***************************************************************\n//* A simple PID controller for Codesys.\n//* by Alexander Jaworowski\n//* Inspiration from https://github.com/br3ttb/Arduino-PID-Library\n//* https://github.com/alexjaw/PID_controller\n//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//***************************************************************\n//* A simple PID controller for Codesys.\n//* by Alexander Jaworowski\n//* Inspiration from https://github.com/br3ttb/Arduino-PID-Library\n//* https://github.com/alexjaw/PID_controller\n//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//***************************************************************\n//* A simple PID controller for Codesys.\n//* by Alexander Jaworowski\n//* Inspiration from https://github.com/br3ttb/Arduino-PID-Library\n//* https://github.com/alexjaw/PID_controller\n//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//***************************************************************\n//* A simple PID controller for Codesys.\n//* by Alexander Jaworowski\n//* Inspiration from https://github.com/br3ttb/Arduino-PID-Library\n//* https://github.com/alexjaw/PID_controller\n//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//***************************************************************\n//* A simple PID controller for Codesys.\n//* by Alexander Jaworowski\n//* Inspiration from https://github.com/br3ttb/Arduino-PID-Library\n//* https://github.com/alexjaw/PID_controller\n//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//* This Library is licensed under a MIT License\n//\n// 2015-02-22\tBug fix in the calculation of CO_I.\n//\t\t\t\tAdded derivative term (d(err)/dt = -d(PV)/dt, i.e.\n//\t\t\t\tderivative on measurements\n//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "END_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n\tELSIF CO > UpperLimit THEN\n\t\tCO := UpperLimit;\n\tEND_IF;\n\t\n\tlastTime := now;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n\tELSIF CO > UpperLimit THEN\n\t\tCO := UpperLimit;\n\tEND_IF;\n\t\n\tlastTime := now;\n\tlastPV := PV;\nEND_IF;", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "PROGRAM Test_PID\nVAR\n\tPID_0: PID_controller;\n\tRedBull: Tank;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 250;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := RedBull.Level,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 2,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 15,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 1,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#100ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 150,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n", "title": "PID_controller-Progs\\Test_PID.st"}, {"text": "PROGRAM Test_PID_Heatx\nVAR\n\tPID_0: PID_controller;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 20;\n\tA_room_with_a_view: HeatExchanger;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,\n    PV := A_room_with_a_view.PV,\n    Kc := 5.0,\n    Ti := 10.0,\n    Td := 1.0,\n    SampleTime := T#2000ms,\n    LowerLimit := 0,\n    UpperLimit := 150,\n    CO => ,  // \u82e5\u4e0d\u9700\u8981\u5355\u72ec\u4f7f\u7528 CO \u7b49\u8f93\u51fa\uff0c\u53ef\u7559\u7a7a\uff0c\u6216\u6839\u636e\u9700\u6c42\u5b9a\u4e49\u53d8\u91cf\u63a5\u6536\n    CO_P => ,\n    CO_I => ,\n    CO_D => \n);\n", "title": "PID_controller-Progs\\Test_PID_Heatx.st"}, {"text": "PROGRAM Test_PID\nVAR\n\tPID_0: PID_controller;\n\tRedBull: Tank;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 250;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := RedBull.Level,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 2,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 15,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 1,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#100ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 150,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nRedBull(\n    Process_In := PID_0.CO,          // \u8f93\u5165\u6d41\u91cf\uff1aPID\u7684\u8f93\u51faCO\n    Process_Out := Process_out,    // \u8f93\u51fa\u6d41\u91cf\uff1a100\uff08\u5916\u90e8\u5b9a\u4e49\uff09\n    Sample_time := T#250ms,// \u91c7\u6837\u65f6\u95f4250ms\n    Lower_limit := 0,// \u6db2\u4f4d\u4e0b\u96500\n    Upper_limit := 500,// \u6db2\u4f4d\u4e0a\u9650500\n    Level =>             // \u8f93\u51fa\u5f53\u524d\u6db2\u4f4d\uff1a\u53cd\u9988\u7ed9PID\u7684PV\n);", "title": "PID_controller-Progs\\Test_PID.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}, {"text": "PROGRAM Test_PID\nVAR\n\tPID_0: PID_controller;\n\tRedBull: Tank;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 250;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := RedBull.Level,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 2,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 15,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 1,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#100ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 150,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nRedBull(\n    Process_In := PID_0.CO,          // \u8f93\u5165\u6d41\u91cf\uff1aPID\u7684\u8f93\u51faCO\n    Process_Out := Process_out,    // \u8f93\u51fa\u6d41\u91cf\uff1a100\uff08\u5916\u90e8\u5b9a\u4e49\uff09\n", "title": "PID_controller-Progs\\Test_PID.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n    Heat_In := PID_controller_0.CO,\n    U := 100,   \n    TC := 2500,\n    Temp_In := 270,\n    Temp_Out := Temp_Out;\n    Sample_time := T#100ms,\n    Temp =>            \n);", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}, {"text": "PROGRAM Test_PID_Heat2\nVAR\n\tPID_controller_0: PID_controller;\n\tHeatExchanger2_0: HeatExchanger2;\n\tSP: REAL := 300;\n\tTemp_out: REAL := 270;\nEND_VAR\n\nPID_controller_0(\n    SP := SP,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := HeatExchanger2_0.Temp,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 50,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 5,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 0,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#250ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 6000,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nHeatExchanger2_0(\n    Heat_In := PID_controller_0.CO,\n    U := 100,   \n    TC := 2500,\n    Temp_In := 270,\n    Temp_Out := Temp_Out;\n", "title": "PID_controller-Progs\\Test_PID_Heat2.st"}], "task_id": "PID_controller"}
{"requirement": "This code is intended to implement a simulation of a tank system that calculates and updates the fluid level based on input and output flow rates, with constraints on minimum and maximum levels and periodic updates.", "provide_code": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR", "docs": [{"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n", "title": "PID_controller-Models\\Tank.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n", "title": "PID_controller-Models\\Tank.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n\t\tLevel := Lower_limit;\n\tELSIF Level > Upper_limit THEN\n\t\tLevel := Upper_limit;\n\tEND_IF;\n\tlastTime := now;\n", "title": "PID_controller-Models\\Tank.st"}, {"text": "//A.J. Jaworowski 2015-02-20\n//Simulering av en tank med RedBull\nFUNCTION_BLOCK Tank\nVAR_INPUT\n\tProcess_In: REAL;  //Fl\u00f6de in per sekund, testa vad som h\u00e4nder on du matar in 100\n\t\t\t\t\t   //D\u00e4refter ska regulatorns OUT in i denna ing\u00e5ng.\n\tProcess_Out: REAL; //Fl\u00f6de ut per sekund, typ 90\n\t\t\t\t\t   //Effekten blir att tanken fylls med 10 per sekund\n\t\t\t\t\t   //Full efter ca 1 minut - testa\n\tSampleTime: TIME;  //Uppdateringstid, typ 100ms\n\tLower_limit: REAL; //Tankens l\u00e4gsta niv\u00e5, typ 0\n\tUpper_limit: REAL; //Tankens max niv\u00e5, kanske 500\nEND_VAR\nVAR_OUTPUT\n\tLevel: REAL; //Niv\u00e5n i tanken\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tproc_sum_in: REAL := 0;\n\tproc_sum_out: REAL := 0;\n\ttemp: REAL;\n\tmillis: UINT := 1000;\n\tproc_out: REAL;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\tLevel := Level +  TIME_TO_REAL(SampleTime)/millis * (Process_In - Process_Out);\n\tIF Level < Lower_limit THEN\n\t\tLevel := Lower_limit;\n\tELSIF Level > Upper_limit THEN\n\t\tLevel := Upper_limit;\n\tEND_IF;\n\tlastTime := now;\nEND_IF;", "title": "PID_controller-Models\\Tank.st"}, {"text": "PROGRAM Test_PID\nVAR\n\tPID_0: PID_controller;\n\tRedBull: Tank;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 250;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := RedBull.Level,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 2,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 15,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 1,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#100ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 150,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nRedBull(\n    Process_In := PID_0.CO,          // \u8f93\u5165\u6d41\u91cf\uff1aPID\u7684\u8f93\u51faCO\n    Process_Out := Process_out,    // \u8f93\u51fa\u6d41\u91cf\uff1a100\uff08\u5916\u90e8\u5b9a\u4e49\uff09\n    Sample_time := T#250ms,// \u91c7\u6837\u65f6\u95f4250ms\n    Lower_limit := 0,// \u6db2\u4f4d\u4e0b\u96500\n    Upper_limit := 500,// \u6db2\u4f4d\u4e0a\u9650500\n    Level =>             // \u8f93\u51fa\u5f53\u524d\u6db2\u4f4d\uff1a\u53cd\u9988\u7ed9PID\u7684PV\n);", "title": "PID_controller-Progs\\Test_PID.st"}, {"text": "PROGRAM Test_PID\nVAR\n\tPID_0: PID_controller;\n\tRedBull: Tank;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 250;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := RedBull.Level,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 2,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 15,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 1,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#100ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 150,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n\n// 2. \u8c03\u7528\u50a8\u7f50\u529f\u80fd\u5757\nRedBull(\n    Process_In := PID_0.CO,          // \u8f93\u5165\u6d41\u91cf\uff1aPID\u7684\u8f93\u51faCO\n    Process_Out := Process_out,    // \u8f93\u51fa\u6d41\u91cf\uff1a100\uff08\u5916\u90e8\u5b9a\u4e49\uff09\n", "title": "PID_controller-Progs\\Test_PID.st"}, {"text": "PROGRAM Test_PID\nVAR\n\tPID_0: PID_controller;\n\tRedBull: Tank;\n\tProcess_out: REAL := 100;\n\tSetPoint: REAL := 250;\nEND_VAR\n\nVAR CONSTANT\nEND_VAR\n\nPID_0(\n    SP := SetPoint,                // \u8bbe\u5b9a\u503c\uff1a\u76ee\u6807\u6db2\u4f4d250\n    PV := RedBull.Level,              // \u8fc7\u7a0b\u503c\uff1a\u50a8\u7f50\u5f53\u524d\u6db2\u4f4d\uff08\u53cd\u9988\uff09\n    Kc := 2,                  // \u6bd4\u4f8b\u589e\u76ca2.0\n    Ti := 15,                  // \u79ef\u5206\u65f6\u95f415.0\n    Td := 1,                  // \u5fae\u5206\u65f6\u95f41.0\n    SampleTime := T#100ms,  // \u91c7\u6837\u65f6\u95f4100ms\n    LowerLimit := 0,  // \u8f93\u51fa\u4e0b\u96500\n    UpperLimit := 150,  // \u8f93\u51fa\u4e0a\u9650150\n    CO => ,                  // PID\u8f93\u51fa\uff1a\u63a7\u5236\u50a8\u7f50\u7684\u8f93\u5165\u6d41\u91cf\n    CO_P => ,                      // \u6bd4\u4f8b\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_I => ,                      // \u79ef\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n    CO_D =>                        // \u5fae\u5206\u90e8\u5206\u8f93\u51fa\uff08\u672a\u4f7f\u7528\u53ef\u7559\u7a7a\uff09\n);\n", "title": "PID_controller-Progs\\Test_PID.st"}, {"text": "//***************************************************************\nFUNCTION_BLOCK PID_controller\nVAR_INPUT\n\tSP : REAL;\n\tPV : REAL;\n\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "\tKc : REAL;\n\tTi : REAL;\n\tTd : REAL;\n\tSampleTime: TIME; //Should be ~0.1 * Tp, Tp : the process time [http://www.controlguru.com/2007/012807.html]\n\tLowerLimit: REAL;\n\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "END_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n\tELSIF CO > UpperLimit THEN\n\t\tCO := UpperLimit;\n\tEND_IF;\n\t\n\tlastTime := now;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "\tUpperLimit: REAL;\nEND_VAR\nVAR_OUTPUT\n\tCO: REAL; //Controller Output\n\tCO_P: REAL; //Prportional term\n\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\tA := EXP(-delta_t/Tp);\n\tB := 1 - A;\n\tC := 2;\n\t\n\t//PV := A * lastPV + B * Kp * CO + C;\n", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "// AJ Jaworowski 2015-02-22\n// Following the recipe by  Peter Nachtwey\n// http://www.controlguru.com/wp/p80.html\nFUNCTION_BLOCK HeatExchanger\nVAR_INPUT\n\tKp: REAL; //System gain\n\tTp: REAL; //Process time\n\tCO: REAL; //Output from controller\n\tDead_t: REAL; //The time before the system responds to the disturbance\n\tC: REAL; //Initial steady state value\n\tSample_time: TIME;\nEND_VAR\nVAR_OUTPUT\n\tPV: REAL; //Process value at t1\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME;\n\tlastPV:REAL := 140;\n\tA: REAL;\n\tB: REAL;\n\tdelta_t: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\tA := EXP(-delta_t/Tp);\n\tB := 1 - A;\n\tC := 2;\n\t\n\t//PV := A * lastPV + B * Kp * CO + C;\n\tPV := 0.987 * lastPV - 0.00679 * CO + C;\n\tlastPV := PV;\n\n\tlastTime := now;\nEND_IF ", "title": "PID_controller-Models\\HeatExchanger.st"}, {"text": "\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n\tELSIF CO > UpperLimit THEN\n\t\tCO := UpperLimit;\n\tEND_IF;\n\t\n\tlastTime := now;\n\tlastPV := PV;\nEND_IF;", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n", "title": "PID_controller-Models\\HeatExchanger2.st"}, {"text": "\tCO_I: REAL; //Integral term\n\tCO_D: REAL; //Derivative term\nEND_VAR\nVAR CONSTANT\n\tmillis: UINT := 1000;\nEND_VAR\nVAR\n\tnow: TIME := T#0S;\n\tlastTime: TIME := T#0S;\n\terr: REAL := 0; //Process error\n\tlastCO_P: REAL := 0;  //Used for calculation of the derivative term\n\tdelta_t: REAL;\n\tlastPV: REAL := 0;\nEND_VAR\n\n//Check parameters\n//Ti division by zero\nIF Ti = 0 THEN\n\tTi := 1;\nEND_IF\n\n//Update PID parameters every sampleTime\nnow := TIME();\nIF ((now - lastTime) > SampleTime) THEN\n\terr := SP - PV;\n\tdelta_t := TIME_TO_REAL(SampleTime)/millis;\n\tCO_P := Kc * err;\n\tCO_I := CO_I + 1/Ti * CO_P * delta_t;\n\t//Add wind-up for CO_I\n\tIF CO_I < LowerLimit THEN\n\t\tCO_I := LowerLimit;\n\tELSIF CO_I > UpperLimit THEN\n\t\tCO_I := UpperLimit;\n\tEND_IF;\n\t\n\t//Observe that d(err)/dt = d(SP)/dt - d(PV)/dt\n\t//If SP constant,\n\t//d(err)/dt = - d(PV)/dt\n\t//Good: no output spikes\n\t//Bad: some processes need more aggressive tuning\n\tIF delta_t <> 0 THEN\n\t\tCO_D := Td * (PV - lastPV)/delta_t;\n\tEND_IF;\n\t\n\t//A different approch would be with a tunable filter\n\t\n\tCO := CO_P + CO_I + CO_D;\n\t//Add wind-up for CO\n\tIF CO < LowerLimit THEN\n\t\tCO := LowerLimit;\n", "title": "PID_controller-PID\\PID_controller.st"}, {"text": "// AJ Jaworowski 2015-02-23\n// Following the presentation on\n// http://openenergymonitor.org/emon/node/2999\nFUNCTION_BLOCK HeatExchanger2\nVAR_INPUT\n\tHeat_In:\t\tREAL;\t\t//In principle a radiator in the room [W]\n\tU:\t\t\t\tREAL;\t\t//Thermal conductance [W/K]\n\tTC:\t\t\t\tREAL;\t\t//Thermal capacity [J/K], commonly cv, specific heat capacity [J/kgK]\n\t\t\t\t\t\t\t\t//we use a smaller value than in reality, so that we can see changes\n\t\t\t\t\t\t\t\t//during a life-time...\n\tTemp_In:\t\tREAL;\t\t//Start temperature in the room [K]\n\tTemp_Out:\t\tREAL;\t\t//Outside temperature [K] \n\tSample_time:\tTIME;\nEND_VAR\nVAR_OUTPUT\n\tTemp:\t\t\tREAL;\t\t//The resulting room temperature\nEND_VAR\nVAR\n\tnow: TIME;\n\tlastTime: TIME := T#0s;\n\tdelta_t: REAL;\n\theat_flow: REAL;\n\tlastTemp: REAL;\nEND_VAR\nVAR CONSTANT\n\tmillis: REAL := 1000;\nEND_VAR\n\nnow := TIME();\nIF ((now - lastTime) > Sample_time) THEN\n\tdelta_t := TIME_TO_REAL(Sample_time)/millis;\n\t\n\t//First calculate net heat\n\t//Heat_In is our heat source\n\t//Second term is heat flow depending on temperature difference\n\t//Obs: At start, set lastTime to start temp Temp_In\n\tIF lastTime = T#0S THEN\n\t\tlastTemp := Temp_In;\n\tEND_IF\n\theat_flow := Heat_In - U * (lastTemp - Temp_Out);\n", "title": "PID_controller-Models\\HeatExchanger2.st"}], "task_id": "Tank"}
